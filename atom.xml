<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bennie&#39;s Blog</title>
  
  <subtitle>Welcome, Here is Bennie&#39;s Blog.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://bennie.im/"/>
  <updated>2019-01-16T07:11:14.225Z</updated>
  <id>http://bennie.im/</id>
  
  <author>
    <name>Bennie</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Git学习随笔</title>
    <link href="http://bennie.im/2019/01/16/git-study-notes/"/>
    <id>http://bennie.im/2019/01/16/git-study-notes/</id>
    <published>2019-01-16T07:09:02.000Z</published>
    <updated>2019-01-16T07:11:14.225Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>记一些Git学习时的笔记供之后参考，可以从博客右侧的导航栏进行便捷浏览。</p><a id="more"></a><h3 id="Git远程操作"><a href="#Git远程操作" class="headerlink" title="Git远程操作"></a>Git远程操作</h3><h4 id="查看-设置远程仓库"><a href="#查看-设置远程仓库" class="headerlink" title="查看/设置远程仓库"></a>查看/设置远程仓库</h4><ul><li>查看远程分支引用列表：<code>git ls-remote</code></li><li>查看本地仓库已经配置的远程仓库信息：<code>git remote -v</code></li><li>查看远程仓库详细信息：<code>git remote show [remote-name]</code></li><li>添加远程仓库：<code>git remote add &lt;remote-name&gt; &lt;url&gt;</code>添加远程仓库URL，并设置一个简写的远程仓库名称，这个名称代替整个URL。这里的remote-name可以任意命名，默认clone过来的仓库，remote-name为origin。</li></ul><h4 id="拉取远程仓库信息"><a href="#拉取远程仓库信息" class="headerlink" title="拉取远程仓库信息"></a>拉取远程仓库信息</h4><p><strong>git fetch</strong></p><ul><li><p><code>git fetch &lt;remote-name&gt;</code>拉取某个远程远程仓库信息，例如：<code>git remote origin</code>，<code>git fetch --all</code>拉取本地仓库所有绑定的远程仓库信息。</p></li><li><p><code>git fetch</code>会将该远程仓库的所有信息（本地没有的）拉取到本地仓库中，更新所有远程分支的提交引用（但不用合并代码）。</p></li></ul><p><strong>git pull</strong></p><p><code>git pull</code>命令，拉取远程主机某个分支的提交更新。命令为：<code>git pull &lt;remote-name&gt; &lt;branch-name&gt;</code></p><p>如果本地分支设置了远程的跟踪分支（上游），那么可以直接使用<code>git pull</code>。</p><p><code>git pull</code> 会查找当前分支所跟踪的服务器与分支，从服务器上抓取数据然后尝试合并入那个远程分支。</p><h3 id="Git常用撤销操作"><a href="#Git常用撤销操作" class="headerlink" title="Git常用撤销操作"></a>Git常用撤销操作</h3><ul><li>撤销文件暂存状态: <code>git reset HEAD &lt;file&gt;</code> </li><li>撤销对文件的修改：<code>git checkout -- &lt;file&gt;</code></li></ul><h3 id="Git重置"><a href="#Git重置" class="headerlink" title="Git重置"></a>Git重置</h3><h4 id="git-reset-命令"><a href="#git-reset-命令" class="headerlink" title="git reset 命令"></a>git reset 命令</h4><p>git reset命令有3种形式.</p><ol><li><code>git reset [-q] [&lt;tree-ish&gt;] [--] &lt;paths&gt;...</code></li><li><code>git reset (--patch | -p) [&lt;tree-ish&gt;] [--] [&lt;paths&gt;...]</code></li><li><code>git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</code></li></ol><p>这里将1、2两种带有paths的形式称为<strong>基于路径的使用方式</strong>，将第3种带有commit的形式称为<strong>基于提交记录的使用方式</strong>。</p><p>根据这2种使用方式，在平时使用时有两种使用场景:</p><ol><li><p><strong>重置暂存区 ，撤销文件暂存。(不会移动HEAD分支指向)</strong></p><p><code>git reset HEAD -- paths</code>或者直接<code>git reset HEAD</code>，由于reset参数默认是<code>--mixed</code>级别，表示将HEAD中的文件状态复制到暂存区。也就是相当于撤销了新文件的暂存，取消了<code>git add</code>命令的操作。这个命令执行完成后，文件的状态是<strong>被修改但未暂存（Changes not staged）</strong>。</p></li><li><p><strong>用来将当前分支的HEAD指针移动到某个提交上</strong></p><p>这种使用方式会根据传递的选项来决定进行什么样的操作, 但都会先将分支的HEAD指针进行移动. 移动的后续操作取决于传入的是<code>--mixed</code>还是<code>--soft</code>或是<code>--hard</code>. </p><ul><li><p><code>--soft</code> 仅仅是移动HEAD指针到某次提交上, 暂存区和工作区不受影响，表示仅仅撤销提交, 重置前如果有加入到暂存区的文件会依旧保留在暂存区, (表示我们希望撤销<code>git commit</code>)</p></li><li><p><code>--mixed</code> 移动HEAD指针后, 如果重置前有加入到暂存区的文件, 那么会被取消暂存, 但工作区不受影响. (表示我们希望撤销<code>git commit</code>以及<code>git add</code>)</p></li><li><p><code>--hard</code> 在移动HEAD指针后, 会将暂存区及工作区都重置为对应提交记录的状态上去. (撤销<code>git commit</code> 、<code>git add</code>以及工作区所有的修改)</p></li></ul></li></ol><p>   <strong>关于git reset [–soft | –mixed | –hard] 命令操作过程:</strong></p><p>   首先git reset命令的三个选项都会将当前分支的HEAD指针进行移动. </p><ul><li><p><code>--soft</code> 仅仅是移动指针，不会对暂存区和工作区做修改，重置后，工作区和index中依旧是之前的文件状态。</p></li><li><p><code>--mixed</code>移动HEAD指针后，再将对应HEAD指向的提交记录中的文件拷贝至index中，所以此时index与HEAD中文件内容一致。可以通过命令<code>git diff --cached &lt;path&gt;</code>查看一下index与HEAD中的文件差异。这时候，工作区和index中的差异就是相对于HEAD中的差异，可以通过命令<code>git diff &lt;commit&gt; &lt;path&gt;</code>查看一下。</p></li><li><p><code>--hard</code>则在移动HEAD指针后先将HEAD中对应的内容复制到index中, 同时还会将index的内容复制给工作区.</p><p> <a href="https://www.git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E7%BD%AE%E6%8F%AD%E5%AF%86" target="_blank" rel="noopener">https://www.git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E7%BD%AE%E6%8F%AD%E5%AF%86</a></p></li></ul><h3 id="Git检出"><a href="#Git检出" class="headerlink" title="Git检出"></a>Git检出</h3><h4 id="检出分支"><a href="#检出分支" class="headerlink" title="检出分支"></a>检出分支</h4><ul><li><p>从Tag检出分支：<code>git checkout -b [branchname] [tagname]</code></p></li><li><p>基于其他分支检出：<code>git checkout -b &lt;new-branch-name&gt; &lt;base-branch-name&gt;</code></p><ul><li>如果基分支是远程分支，那么检出分支会建立绑定关系（设置其为跟踪分支或上游分支）：<code>git checkout -b [branch][remotename]/[branch]</code></li><li><code>git checkout -b [branch][remotename]/[branch]</code>可简写为：<code>git checkout --track [remotename]/[branch]</code></li></ul></li></ul><h4 id="撤销对未暂存文件的修改"><a href="#撤销对未暂存文件的修改" class="headerlink" title="撤销对未暂存文件的修改"></a>撤销对未暂存文件的修改</h4><p><code>git checkout -- &lt;file&gt;</code></p><h3 id="Git-Tag-操作"><a href="#Git-Tag-操作" class="headerlink" title="Git Tag 操作"></a>Git Tag 操作</h3><ul><li>查看tag列表：<code>git tag</code></li><li>查看tag信息：<code>git show &lt;tag-name&gt;</code></li><li>创建tag：<code>git tag -a v1.4 -m &#39;my version 1.4&#39; &lt;commit-id&gt;</code></li><li>删除tag：<code>git tag -d &lt;tag-name&gt;</code></li><li>推送tag到远程：<code>git push origin &lt;tag-name&gt;</code> / 推送本地所有tag：<code>git push --tags</code></li><li>删除远程tag：<code>git push origin :refs/tags/&lt;tag-name&gt;</code>（将远程tag引用至空）</li></ul><p><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013762144381812a168659b3dd4610b4229d81de5056cc000" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013762144381812a168659b3dd4610b4229d81de5056cc000</a></p><h3 id="Git配置"><a href="#Git配置" class="headerlink" title="Git配置"></a>Git配置</h3><p><code>git config section.key &quot;配置值&quot;</code>，例如<code>git config user.name &quot;Bennie Joey&quot;</code></p><p>配置的3个级别，<code>-e</code>表示编辑配置文件：</p><p><code>git config -e</code>当前仓库，优先级最高<br><code>git config --global -e</code>当前用户<br><code>git config --system -e</code>系统全局，优先级最低</p><p><code>git config --list</code>列出所有 Git 当时能找到的配置。</p><h4 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h4><p>命令配置：<code>git config --global alias.&lt;别名&gt; &#39;命令内容&#39;</code>，如：<code>git config --global alias.st &#39;status&#39;</code></p><p>手动配置：<code>git config -e --global</code>编辑配置文件，加入到”[alias]”节即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ci = commit</span><br><span class="line">cim = commit -m</span><br><span class="line">co = checkout</span><br><span class="line">cob = checkout -b</span><br><span class="line">lgol = log --oneline</span><br><span class="line">st = status</span><br><span class="line">sts = status -s</span><br><span class="line">a = !git add . &amp;&amp; git status</span><br><span class="line">au = !git add -u . &amp;&amp; git status</span><br><span class="line">aa = !git add . &amp;&amp; git add -u . &amp;&amp; git status</span><br><span class="line">ca = commit --amend # careful</span><br><span class="line">ac = !git add . &amp;&amp; git commit</span><br><span class="line">acm = !git add . &amp;&amp; git commit -m</span><br><span class="line">lg = log --color --graph --pretty=format:&apos;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&apos; --abbrev-commit</span><br><span class="line">d = diff</span><br><span class="line">alias = !git config --list | grep &apos;alias\\.&apos; | sed &apos;s/alias\\.\\([^=]*\\)=\\(.*\\)/\\1\\\t =&gt; \\2/&apos; | sort</span><br><span class="line">br = branch</span><br><span class="line">unstage = reset HEAD --</span><br></pre></td></tr></table></figure><h3 id="Git分支操作"><a href="#Git分支操作" class="headerlink" title="Git分支操作"></a>Git分支操作</h3><h4 id="检出分支-1"><a href="#检出分支-1" class="headerlink" title="检出分支"></a>检出分支</h4><ol><li>分支可以从一个<strong>commit</strong>、<strong>tag</strong>、<strong>其他分支</strong>上进行基础。</li><li>创建分支，只是相当于从commit对象上建立了一个指针，然后让其内部的HEAD指针指向这个分支，就会知道当前工作区处于哪个分支上（可以将 HEAD 想象为当前分支的别名）。</li></ol><h4 id="远程分支操作"><a href="#远程分支操作" class="headerlink" title="远程分支操作"></a>远程分支操作</h4><h5 id="设置本地分支的远程跟踪分支"><a href="#设置本地分支的远程跟踪分支" class="headerlink" title="设置本地分支的远程跟踪分支"></a>设置本地分支的远程跟踪分支</h5><p>设置后可以直接在当前分支上使用<code>git pull</code>、<code>git push</code>。</p><ol><li><p>从远程分支检出本地分支（会自动设置远程分支为跟踪分支），见：<a href="#检出分支">检出分支</a></p></li><li><p>修改或者本地分支的远程跟踪分支：<code>git branch -u/--set-upstream-to origin/远程分支名x</code> </p><p><code>git branch (--set-upstream-to=&lt;upstream&gt; | -u &lt;upstream&gt;) [&lt;branchname&gt;]</code></p></li><li><p>查看本地分支的远程跟踪分支信息：<code>git branch -vv</code> 这会将所有的本地分支列出来并且包含更多的信息，如每一个分支正在跟踪哪个远程分支与本地分支是否是领先、落后或是都有。</p></li></ol><h5 id="新建远程分支"><a href="#新建远程分支" class="headerlink" title="新建远程分支"></a>新建远程分支</h5><p>将本地分支推送到远程（远程新建）</p><h5 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h5><h4 id="分支合并"><a href="#分支合并" class="headerlink" title="分支合并"></a>分支合并</h4><h5 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h5><p>把两个分支的最新快照（<code>C3</code> 和 <code>C4</code>）以及二者最近的共同祖先（<code>C2</code>）进行三方合并，合并的结果是生成一个新的快照（并提交）</p><h5 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h5><h3 id="Git信息查看"><a href="#Git信息查看" class="headerlink" title="Git信息查看"></a>Git信息查看</h3><h4 id="查看历史提交信息"><a href="#查看历史提交信息" class="headerlink" title="查看历史提交信息"></a>查看历史提交信息</h4><ul><li><p><code>git log &lt;file-path&gt;</code> 查看单个文件/目录的提交记录</p></li><li><p><code>git log --flow &lt;file-path&gt;</code> 追溯文件全部历史，包括删除、重命名文件名。、</p></li><li><p><code>git log pretty=oneline/short/full/fuller/format:&lt;格式化&gt;</code>，format参数：</p><p>| 选项 | 说明 |<br>| —– | ——————————————- |<br>| <code>%H</code> | 提交对象（commit）的完整哈希字串 |<br>| <code>%h</code> | 提交对象的简短哈希字串 |<br>| <code>%T</code> | 树对象（tree）的完整哈希字串 |<br>| <code>%t</code> | 树对象的简短哈希字串 |<br>| <code>%P</code> | 父对象（parent）的完整哈希字串 |<br>| <code>%p</code> | 父对象的简短哈希字串 |<br>| <code>%an</code> | 作者（author）的名字 |<br>| <code>%ae</code> | 作者的电子邮件地址 |<br>| <code>%ad</code> | 作者修订日期（可以用 –date= 选项定制格式） |<br>| <code>%ar</code> | 作者修订日期，按多久以前的方式显示 |<br>| <code>%cn</code> | 提交者（committer）的名字 |<br>| <code>%ce</code> | 提交者的电子邮件地址 |<br>| <code>%cd</code> | 提交日期 |<br>| <code>%cr</code> | 提交日期，按多久以前的方式显示 |<br>| <code>%s</code> | 提交说明 |</p></li><li><p>git log常用命令选项<br>| 选项 | 说明 |<br>| ——————— | ———————————- |<br>| <code>-(n)</code> | 仅显示最近的 n 条提交 |<br>| <code>--since</code>, <code>--after</code> | 仅显示指定时间之后的提交。 |<br>| <code>--until</code>, <code>--before</code> | 仅显示指定时间之前的提交。 |<br>| <code>--author</code> | 仅显示指定作者相关的提交。 |<br>| <code>--committer</code> | 仅显示指定提交者相关的提交。 |<br>| <code>--grep</code> | <strong>仅显示含指定关键字的提交</strong> |<br>| <code>-S</code> | <strong>仅显示添加或移除了某个关键字的提交</strong> |</p></li></ul><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2" target="_blank" rel="noopener">https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2</a></p><h4 id="查看对象库信息"><a href="#查看对象库信息" class="headerlink" title="查看对象库信息"></a>查看对象库信息</h4><ul><li><code>git show &lt;branch&gt;</code></li></ul><h3 id="命令使用"><a href="#命令使用" class="headerlink" title="命令使用"></a>命令使用</h3><h4 id="底层命令"><a href="#底层命令" class="headerlink" title="底层命令"></a>底层命令</h4><ul><li><p><code>git cat-file</code>查看对象内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-t 查看对象类型。类型可以是blob, tree, commit, tag其中之一</span><br><span class="line">-s 显示对象大小</span><br><span class="line">-e exit with zero when there&apos;s no error</span><br><span class="line">-p 打印对象内容</span><br></pre></td></tr></table></figure></li><li><p><code>git ls-files</code> 浏览文件内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-z paths are separated with NUL character</span><br><span class="line">-t identify the file status with tags</span><br><span class="line">-v use lowercase letters for &apos;assume unchanged&apos; files</span><br><span class="line">-f use lowercase letters for &apos;fsmonitor clean&apos; files</span><br><span class="line">-c, --cached 显示已被暂存的文件。</span><br><span class="line">-d, --deleted 显示已经被删除的文件。</span><br><span class="line">-m, --modified 显示被修改的文件。</span><br><span class="line">-o, --others show other files in the output</span><br><span class="line">-i, --ignored 显示被忽略的文件。</span><br><span class="line">-s, --stage show staged contents&apos; object name in the output</span><br><span class="line">-k, --killed 显示文件系统上需要被移除的文件</span><br><span class="line">--directory show &apos;other&apos; directories&apos; names only</span><br></pre></td></tr></table></figure></li><li><p><code>git rev-parse</code> 将标签、相对名、简写或绝对名称转成实际的提交散列ID。</p></li></ul><h4 id="git-rm命令"><a href="#git-rm命令" class="headerlink" title="git rm命令"></a>git rm命令</h4><ul><li><code>git rm &lt;file&gt; --cached</code> 移除索引中已经暂存的文件（工作区文件依旧保留）。</li><li><code>git rm &lt;file&gt;</code>移除索引和工作区的文件。（文件需要被暂存）</li><li><code>git rm -f &lt;file&gt;</code> -f命令 表示在删除之前已存在被加到暂存区的文件一样会被强制移除。</li></ul><h4 id="git-diff-命令"><a href="#git-diff-命令" class="headerlink" title="git diff 命令"></a>git diff 命令</h4><p>该命令用来查看文件的不同.</p><ul><li><code>git diff &lt;file&gt;</code>查看<strong>工作区</strong>相对于<strong>暂存区</strong>作出的更改。（默认）</li><li><code>git diff &lt;commit&gt; &lt;file&gt;</code> 查看<strong>工作区</strong>与<strong>指定提交</strong>的文件差异</li><li><code>git diff --cached [&lt;commit&gt;] &lt;file&gt;</code> 查看<strong>暂存区</strong>与<strong>HEAD</strong>或<strong>指定提交</strong>中的差异。</li><li><code>git diff &lt;commit&gt; &lt;commit&gt;</code> 查询两次提交中的文件差异。</li></ul><p><code>git diff &lt;file&gt;</code> 表示查看工作区相对于暂存区的差异</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git diff t.txt </span><br><span class="line">diff --git a/t.txt b/t.txt</span><br><span class="line">index 1191247..01e79c3 100644</span><br><span class="line">--- a/t.txt</span><br><span class="line">+++ b/t.txt</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> 1</span><br><span class="line"> 2</span><br><span class="line">+3</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;记一些Git学习时的笔记供之后参考，可以从博客右侧的导航栏进行便捷浏览。&lt;/p&gt;
    
    </summary>
    
      <category term="Git" scheme="http://bennie.im/categories/Git/"/>
    
    
      <category term="Git" scheme="http://bennie.im/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Maven中的一些概念及笔记</title>
    <link href="http://bennie.im/2018/07/24/concepts-and-notes-in-maven/"/>
    <id>http://bennie.im/2018/07/24/concepts-and-notes-in-maven/</id>
    <published>2018-07-24T07:36:13.000Z</published>
    <updated>2018-12-29T08:13:04.820Z</updated>
    
    <content type="html"><![CDATA[<p>以前粗浅的学习过Maven的一些概念，但后来时间长了忘记了。虽然也会用，但做项目期间也经常断断续续的查找Maven相关的概念及知识，总觉得不是个事没有建立起比较整体的概念，所以这里写个笔记记录一下Maven的一些概念以及使用方面的东西，方便以后查阅。</p><a id="more"></a><p>记得以前看到过一句话，说是如果你无法向别人讲清楚一个东西，那说明你没有真正的掌握它。所以我记东西或者说写博客有个特点，会将自己做为第三者的角度去对待，一方面是为了记录下来能让自己以后一个参考，一方面也是为了想让自己和别人理解这个东西，所以文章可能写的有些唠叨，因为记录了一些在了解过程中的疑问及想法，毕竟学习的时候总有点好奇心不是。</p><h3 id="Maven生命周期和插件"><a href="#Maven生命周期和插件" class="headerlink" title="Maven生命周期和插件"></a>Maven生命周期和插件</h3><p>在开始之前先说明一下，Maven的生命周期和插件是两个东西，Maven的生命周期实际上不负责任何实际的东西，实际执行生命周期的阶段时是依靠绑定其绑定到的插件目标上来完成的。可以理解为，生命周期中定义了一些阶段行为，执行阶段行为时，会去寻找其绑定插件对应的目标来完成指定的操作。光说概念还是有点抽象，下面来详细说一下生命周期和插件是个什么东东以及它们如何完成相互配合的。</p><h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>在生命周期中首先要明白两个概念：</p><ul><li><strong>生命周期：</strong>Maven拥有三套<strong>相互独立</strong>的生命周期，它们分别为clean、default和site。</li><li><strong>生命周期中的阶段</strong>：每个生命周期包含一些阶段（phase），这些阶段是有顺序的，并且后面的阶段依赖于前面的阶段，<strong>用户和Maven最直接的交互方式就是调用这些生命周期阶段。</strong>(这句话如何理解，下文会说)</li></ul><p>那这时候我们就想要知道，每个生命周期中都有哪些阶段？都负责些什么操作。</p><blockquote><p>在Maven的官网文档，我们可以查阅<strong>Maven各生命周期包含的阶段</strong>：<a href="https://maven.apache.org/ref/3.5.3/maven-core/lifecycles.html" target="_blank" rel="noopener">https://maven.apache.org/ref/3.5.3/maven-core/lifecycles.html</a> ，还可以<strong>查阅这里了解一下各阶段的功能介绍</strong>：<a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference" target="_blank" rel="noopener">https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference</a></p></blockquote><p>这里以clean生命周期为例，可以看到它包含的阶段有pre-clean、clean和post-clean。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">phases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>pre-clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>post-clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">phases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">default-phases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">clean</span>&gt;</span></span><br><span class="line">    org.apache.maven.plugins:maven-clean-plugin:2.5:clean</span><br><span class="line">  <span class="tag">&lt;/<span class="name">clean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">default-phases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下面的<code>default-phases</code>中将clean生命周期中的clean阶段绑定到了插件<code>org.apache.maven.plugins:maven-clean-plugin:2.5</code>的clean目标上。<strong>那这个意思就是说，生命周期中的某个具体的阶段可以绑定到插件的某个具体的目标上。</strong></p><p>同样，我们可以再看看site生命周期中与插件的绑定关系。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">phases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>pre-site<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>site<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>post-site<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phase</span>&gt;</span>site-deploy<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">phases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">default-phases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">site</span>&gt;</span></span><br><span class="line">    org.apache.maven.plugins:maven-site-plugin:3.3:site</span><br><span class="line">  <span class="tag">&lt;/<span class="name">site</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">site-deploy</span>&gt;</span></span><br><span class="line">    org.apache.maven.plugins:maven-site-plugin:3.3:deploy</span><br><span class="line">  <span class="tag">&lt;/<span class="name">site-deploy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">default-phases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>看完clean以及site的生命周期阶段与插件目标的绑定关系后，我还想要看看default生命周期中的绑定关系是怎样的。我这里留到最后说default生命周期是因为它有一些特殊，如果你打开上文给的生命周期各阶段的链接后，你会发现官网告诉你说default生命周期没有关联到任何插件，然后又告诉你说绑定到这个生命周期中的插件是取决于packing的打包类型来单独定义的。</p><blockquote><p><code>default</code> lifecycle is defined <strong>without</strong> any associated plugin. Plugin bindings for this lifecycle are <a href="https://maven.apache.org/ref/3.5.3/maven-core/default-bindings.html" target="_blank" rel="noopener">defined separately for every packaging</a></p></blockquote><p>点开链接后我们就可以看到在default生命周期的处理上，针对不同的packing类型提供了不同的阶段到插件目标的绑定关系。一开始我没弄明白为什么要这么干，后来觉得应该是不同的打包类型取决于不同的应用场景，所以要根据需要使用不同的插件（个人理解）。例如packing类型为pom的通常不需要测试、编译这些处理。然后其他的打包类型，虽然大部分像资源处理、测试、编译都是需要的，但可以看到打包时所使用的插件还是不一样的。</p><p>例如packing类型为jar的和为war的package阶段绑定的插件就不一样。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- packing为jar --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span>&gt;</span></span><br><span class="line">    org.apache.maven.plugins:maven-jar-plugin:2.4:jar</span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!-- packing为war --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span>&gt;</span></span><br><span class="line">    org.apache.maven.plugins:maven-war-plugin:2.2:war</span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>上面简单看了一下各个生命周期与插件目标的绑定关系，也对各个阶段的基本功能有了一些了解。但另一点我对Maven中<strong>default生命周期中大部分的阶段都没有绑定到实际的插件目标</strong>有些不太理解，<a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference" target="_blank" rel="noopener">在这里</a>可以看到default生命周期中定义了一系列的阶段，但是将网页往下拉一点的<a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Built-in_Lifecycle_Bindings" target="_blank" rel="noopener">Built-in_Lifecycle_Bindings</a>中可以仔细看一下就可以发现default生命周期中并不是所有的阶段都绑定到了插件目标上。例如<code>generate-test-sources</code>、<code>process-test-classes</code>、<code>integration-test</code>等就没有具体的绑定关系，所以我猜想如果这些阶段得以执行的话，那么可能是Maven内部做了一些绑定处理，否则就是它们不会有实际的行为。，这点目前还需要进一步证实。</p></blockquote><p>上面介绍完了maven中三大生命周期阶段到插件目标的绑定关系，对生命周期应该有一个初步的理解了。</p><p>在一开始对生命周期阶段的描述中提到了<strong>“阶段是有顺序的，而且后面的阶段会依赖前面的阶段。”</strong></p><p>这里还以clean生命周期来举例说明：</p><blockquote><p>当用户调用pre-clean的时候（在命令行输入mvn pre-clean的时候），只有pre-clean阶段得以执行；<br>当用户调用clean的时候，pre-clean和clean阶段会按顺序执行；<br>当用户调用post-clean的时候，pre-clean、clean和post-clean会按顺序执行。</p></blockquote><p>并且上面说到生命周期是相互独立的，意思是说，我们可以调用某个生命周期中的某个具体的阶段，而命令执行时，不同的生命周期之间不会有影响。</p><p>用clean来举例只是帮助理解概念，事实上真正核心的生命周期是default，它里面定义了一系列的阶段。那么这时候我们就知道，我们执行default生命周期的install阶段时，在install阶段之前的所有阶段都会执行，从而可以帮我们完成validate、initialize、resources、compile、test等一系列的操作，从而来简化我们的工作。</p><p>这就是生命周期方便的地方以及它所完成的事情。</p><p><strong>这里介绍一下在使用时如何执行生命周期的目标来完成相应的任务：</strong></p><p>我们在命令行如果想要执行生命周期中的阶段时，可以不需要输入生命周期的名字，直接输入具体的阶段名称就可以。Maven会自己去找这个阶段是属于哪个生命周期，然后并执行他前面所有的阶段。例如想要执行default中的packge阶段完成打包操作，那么执行<code>mvn packge</code>就可以了。</p><p><strong>此外</strong>，Maven也允许多个阶段一起执行（可以是不同生命周期中）</p><p>例如<code>mvn clean deploy site-deploy</code>执行了clean生命周期的clean阶段、default生命周期的deploy阶段，以及site生命周期的site-deploy阶段。实际执行的阶段为clean生命周期的pre-clean、clean阶段，default生命周期的所有阶段，以及site生命周期的所有阶段。</p><p>通常我们在使用时，会经常用到<code>mvn clean package</code>来在执行打包前清理上一次的构建。</p><h4 id="插件和目标"><a href="#插件和目标" class="headerlink" title="插件和目标"></a>插件和目标</h4><h3 id="聚合和继承"><a href="#聚合和继承" class="headerlink" title="聚合和继承"></a>聚合和继承</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;以前粗浅的学习过Maven的一些概念，但后来时间长了忘记了。虽然也会用，但做项目期间也经常断断续续的查找Maven相关的概念及知识，总觉得不是个事没有建立起比较整体的概念，所以这里写个笔记记录一下Maven的一些概念以及使用方面的东西，方便以后查阅。&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
      <category term="Maven" scheme="http://bennie.im/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>Java中finally和return的执行顺序</title>
    <link href="http://bennie.im/2018/06/27/execution-order-of-finally-and-return-in-java/"/>
    <id>http://bennie.im/2018/06/27/execution-order-of-finally-and-return-in-java/</id>
    <published>2018-06-26T18:12:26.000Z</published>
    <updated>2018-12-29T08:13:04.794Z</updated>
    
    <content type="html"><![CDATA[<p>try…catch…finally语句中return语句的执行测试.</p><p>有时候想起来finally和return语句的执行顺序上会有一些混乱, 这里写了几个测试例子来弄清楚它们的执行顺序, 虽然网上也有很多这样的文章, 但还是觉得自己实际写个例子体会一下会更加映像深刻些.</p><p>大致有2种形式, 分别是带有catch语句和不带catch语句: </p><p><strong>不带有catch语句</strong></p><ol><li>try中有return语句, finally中没有return语句.</li><li>try代码块和finally中都有return语句.</li></ol><p><strong>带有catch语句</strong></p><ol><li>try…catch…语句块中都有return语句, 但finally中没有return语句.</li><li>try…catch…finally…语句块中都有return语句.</li></ol><a id="more"></a><p>这里考虑catch语句的情况是因为, catch语句的加入会影响try语句的执行, 如果try和catch的语句块中都有return语句, 那么当try语句块中代码发生异常时, 那么就相当于if else的选择, 只能有一个return语句会被执行. 这个下文中会列举具体的情形代码.</p><p>我们先从简单的不带有catch代码块的情形开始出发来了解.</p><h2 id="不带有catch语句的情形"><a href="#不带有catch语句的情形" class="headerlink" title="不带有catch语句的情形"></a>不带有catch语句的情形</h2><h3 id="1-try中有return语句-finally中没有return语句"><a href="#1-try中有return语句-finally中没有return语句" class="headerlink" title="1. try中有return语句, finally中没有return语句."></a>1. try中有return语句, finally中没有return语句.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAndFinalTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="keyword">new</span> ReturnAndFinallyTest().test();</span><br><span class="line">        System.out.println(<span class="string">"test方法返回值: "</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">"try代码块"</span>);</span><br><span class="line">            i += <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">"finally代码块, i = "</span> + i);</span><br><span class="line">            i += <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果:</p><blockquote><p>try代码块<br>finally代码块, i = 110<br>test方法返回值: 110</p></blockquote><p>通过这个测试结果可以看到以下现象:</p><ol><li>finally中的语句是在try中的return语句之后执行的.</li><li>try中的return语句并没有真正的让方法返回. </li><li>main方法中获取到值是110, 说明方法返回值不是finally中修改后的i变量值. <strong>所以可以确定try中return语句的i变量值在执行finally语句之前就已经确定了.</strong></li></ol><p><strong>结论</strong>: try中的return语句不会让方法真正返回, 但在return语句执行时就确定了方法最终的返回值, 真正的方法返回是在执行了finally语句块中的代码之后.</p><p><strong>关于现象3, 我们会想到一个问题</strong>:<br>在try中return语句返回的是一个基本类型int, 所以在finally中做赋值操作不会影响到返回的值, 但如果是一个引用类型, 我在finally中将引用的内容更改掉会不会影响try中return语句的返回的内容. 关于这点可以参考后文中的<a href="#返回值为引用类型时是否会修改返回值">返回值为引用类型时是否会修改返回值</a></p><h3 id="2-try代码块和finally中都有return语句"><a href="#2-try代码块和finally中都有return语句" class="headerlink" title="2. try代码块和finally中都有return语句."></a>2. try代码块和finally中都有return语句.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAndFinallyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="keyword">new</span> ReturnAndFinallyTest().test();</span><br><span class="line">        System.out.println(<span class="string">"test方法返回值: "</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"try代码块"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 这里做一次赋值操作.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"finally代码块, i = "</span> + i);</span><br><span class="line"></span><br><span class="line">            i += <span class="number">20</span>;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果:</p><blockquote><p>try代码块<br>finally代码块, i = 110<br>test方法返回值: 130</p></blockquote><p>通过这个测试结果可以看到以下现象:</p><ol><li>finally中获取到的i变量为110说明try中的return语句赋值操作生效了.</li><li>方法最终的返回为130说明try中return语句并没有真正的让方法返回. </li><li>test方法返回值为130表示finally中的return语句生效了, 说明finally中的return让方法最终返回.</li></ol><p><strong>结论</strong>: try中的return语句虽然执行了但并没有引起方法的返回并且即使其中有return语句, 还是会执行finally中的代码, 当发现finally中也有return语句时, 就使用该return语句作为方法的最终返回值.</p><h2 id="带有catch语句"><a href="#带有catch语句" class="headerlink" title="带有catch语句"></a>带有catch语句</h2><p>###1. try…catch…语句块中都有return语句, 但finally中没有return语句. </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAndFinallyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="keyword">new</span> ReturnAndFinallyTest().test();</span><br><span class="line">        System.out.println(<span class="string">"test方法返回值: "</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try代码块"</span>);</span><br><span class="line">            <span class="comment">// 触发一个异常</span></span><br><span class="line">            <span class="keyword">int</span> a = i / <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch代码块"</span>);</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"finally代码块, i = "</span> + i);</span><br><span class="line">            i += <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果:</p><blockquote><p>try代码块<br>catch代码块<br>finally代码块, i = 101<br>test方法返回值: 101</p></blockquote><p>通过这个测试结果可以看到以下现象:</p><ol><li>try中的代码发生异常后, try代码块的return语句没有起作用.</li><li>方法返回值为101, 说明catch语句让方法返回了.</li></ol><p><strong>结论</strong>: </p><ol><li>所以我们可以得出一个结论, try和catch其实从某个角度理解就像是if else, 如果try中有异常, 那就走catch流程, 如果没有那就走自己的流程. 所以具体执行try和catch中的哪个return语句是取决于try中是否有异常发生. </li><li>同时我们也可以看到在try和catch中都有return语句时, test方法就不需要在方法最末尾再去写return语句了, 因为try和catch中的return语句总有一个会执行.</li></ol><h3 id="2-try…catch…finally…语句块中都有return语句"><a href="#2-try…catch…finally…语句块中都有return语句" class="headerlink" title="2. try…catch…finally…语句块中都有return语句."></a>2. try…catch…finally…语句块中都有return语句.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAndFinallyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="keyword">new</span> ReturnAndFinallyTest().test();</span><br><span class="line">        System.out.println(<span class="string">"test方法返回值: "</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"try代码块"</span>);</span><br><span class="line">            <span class="keyword">int</span> a = i / <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"catch代码块"</span>);</span><br><span class="line">            <span class="keyword">return</span> i += <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"finally代码块, i = "</span> + i);</span><br><span class="line">            i += <span class="number">20</span>;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果:</p><blockquote><p>try代码块<br>catch代码块<br>finally代码块, i = 101<br>test方法返回值: 121</p></blockquote><p>通过这个测试结果可以看到以下现象:</p><ol><li>方法返回值为121, 说明是catch中的return语句的赋值操作生效了, 但并没有让方法返回.</li><li>最后让方法返回是的finally中的return语句.</li></ol><p><strong>结论</strong>: 无论try和catch语句中是否有return, 都会执行finally中的代码并且如果finally中有return语句, 那么就以该return语句作为方法的返回. (这一点和之前的现象一样)</p><h2 id="返回值为引用类型时是否会修改返回值"><a href="#返回值为引用类型时是否会修改返回值" class="headerlink" title="返回值为引用类型时是否会修改返回值"></a>返回值为引用类型时是否会修改返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter and setter</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// toString</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReturnAndFinallyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> ReturnAndFinallyTest().test();</span><br><span class="line">        System.out.println(<span class="string">"test方法返回值: "</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        User u1 = <span class="keyword">new</span> User(<span class="string">"用户1"</span>, <span class="number">11</span>);</span><br><span class="line">        User u2 = <span class="keyword">new</span> User(<span class="string">"用户2"</span>, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"try代码块"</span>);</span><br><span class="line">            user = u1;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"finally代码块"</span>);</span><br><span class="line">            user = u2;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// user.setAge(13);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们用到一个User类用来模拟一个对象, 然后再try代码块里面为<code>User user</code>引用, 赋值了u1这个对象, finally代码块里面为<code>User user</code>赋值为u2. 如果<code>user = u2;</code>语句影响到try代码块里的<code>return user;</code>的返回结果, 那么说明可以对引用的对象内容进行修改.</p><p>执行结果:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">try代码块</span><br><span class="line">finally代码块</span><br><span class="line">test方法返回值: User&#123;name=&apos;用户1&apos;, age=11&#125;</span><br></pre></td></tr></table></figure><p>通过这个测试结果可以看到以下现象:</p><ol><li>main方法的输出结果说明, finally中对user的引用地址进行的修改是未生效的.</li><li>同样的和之前的基本数据类型int的测试结果一样, 在finally代码块的代码执行之前try中<code>return user;</code>的user引用就已经被确定下来, 无法将引用更改到其他的User对象上.</li></ol><p>结论:</p><ol><li>不管try中返回是基本类型还是引用类型, 在finally中是无法对try中return语句的返回值做修改的, 这里的返回值, 如果是基本类型, 那么传递的基本类型的变量值; 如果是引用类型, 那么传递的是引用类型的对象引用地址. </li><li>虽然在finally中更改try中return语句的引用地址, 但可以修改它引用的对象的内容, 例如上面注释的<code>user.setAge(13);</code>是可以操作成功的.</li></ol><p><strong>其实根本上就是java中的值传递问题, 基本类型传递的是值, 引用类型传递的是对象引用地址.</strong></p><h2 id="最后总结"><a href="#最后总结" class="headerlink" title="最后总结"></a>最后总结</h2><p>总结内容是从参考文章中的评论里拷贝过来的. (因为懒得自己写了…)</p><blockquote><p> finally块的语句在try或catch中的return语句执行之后返回之前执行且<strong>finally里的修改语句不能影响try或catch中 return已经确定的返回值</strong>，若finally里也有return语句则覆盖try或catch中的return语句直接返回。</p></blockquote><blockquote><ol><li>执行时机问题。finally总会执行（除非是System.exit()），正常情况下在try后执行，抛异常时在catch后面执行，即使try和catch中存在return语句</li><li>finally中是否有return语句，决定了方法是否最终从finally中返回。</li><li>返回值问题。可以认为try（或者catch）中的return语句的返回值放入线程栈的顶部：如果返回值是基本类型则顶部存放的就是值，如果返回值是引用类型，则顶部存放的是引用。finally中的return语句可以修改引用所对应的对象，无法修改基本类型。但不管是基本类型还是引用类型，都可以被finally返回的“具体值”具体值覆盖 </li><li>不建议在finally中使用return语句，如果有，eclipse会warning“finally block does not complete normally”</li></ol></blockquote><p><strong>参考文章:</strong><br><a href="https://www.cnblogs.com/lanxuezaipiao/p/3440471.html" target="_blank" rel="noopener">Java finally语句到底是在return之前还是之后执行？</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;try…catch…finally语句中return语句的执行测试.&lt;/p&gt;
&lt;p&gt;有时候想起来finally和return语句的执行顺序上会有一些混乱, 这里写了几个测试例子来弄清楚它们的执行顺序, 虽然网上也有很多这样的文章, 但还是觉得自己实际写个例子体会一下会更加映像深刻些.&lt;/p&gt;
&lt;p&gt;大致有2种形式, 分别是带有catch语句和不带catch语句: &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不带有catch语句&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;try中有return语句, finally中没有return语句.&lt;/li&gt;
&lt;li&gt;try代码块和finally中都有return语句.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;带有catch语句&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;try…catch…语句块中都有return语句, 但finally中没有return语句.&lt;/li&gt;
&lt;li&gt;try…catch…finally…语句块中都有return语句.&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>记一下 Invalid bound statement (not found) 的问题</title>
    <link href="http://bennie.im/2018/06/02/Invalid-bound-statement-not-found-in-mybatis/"/>
    <id>http://bennie.im/2018/06/02/Invalid-bound-statement-not-found-in-mybatis/</id>
    <published>2018-06-02T10:15:47.000Z</published>
    <updated>2018-12-29T08:13:04.807Z</updated>
    
    <content type="html"><![CDATA[<p>记一下在开发时出现的一个问题, 弄了很久才得到解决.<br>网上查询到的回答大概都是如这篇文章回答的一样来解决 <a href="https://www.jianshu.com/p/800fe918cc7a" target="_blank" rel="noopener">https://www.jianshu.com/p/800fe918cc7a</a><br>但进行操作后依旧未能解决我的问题.</p><a id="more"></a><p>我的问题如下:<br>我和同事共同负责系统模块的开发, 我的模块需要依赖他开发的模块. 我们的项目都是基于Spring Boot开发的项目, 我在Application的启动类中使用<code>@MapperScan</code>注解扫描我们两个人工程中的Mapper接口文件. 这里需要说明的是, 由于我们是开发两个模块, 所以在配置Mapper扫描包的路径需要是我们包路径的公共部分, 例如我的Mapper接口存放在了包<code>com.xxx.system.user.mapper</code> , 他的存放在<code>com.xxx.system.blog.dao</code>中. 所以这时候我配置的Mapper接口包扫描路径为<code>@MapperScan(basePackages = {&quot;com.xxx.system&quot;})</code>, 以便扫描到我们两个工程的Mapper接口包.<br>但是这样设置后我遇到一个问题, 由于我们在开发中大多数也会在Service层提供一个抽象接口, 例如<code>com.xxx.system.usser.service.IUserService</code>, 然后还为该接口提供一个实现类UserServiceImpl. 这时候<code>@MapperScan</code>注解会发生一个错误, 会奇怪的将IUserService这个接口当做是Mybatis的Mapper接口, 然后还尝试拿去跟Mapper.xml中去做映射关联.<br>这时候就会发生Invalid bound statement (not found)的问题. 解决方法是可以选择在<code>@MapperScan</code>注解中分两次配置两个工程的Mapper接口包路径, 或者将两个人的包命名为同一个路径下, 例如最后不要一个人是mapper中, 一个人是放在dao中, 统一一下, 这样就可以写成<code>com.xxx.system.*.mapper</code>用*通配符来代替中间的部分.</p><p>这里还说另一个问题, 是classpath*与classpath的问题.</p><p>由于是基于SpringBoot整合的Mybatis, 所以可以在application.properties用<code>mybatis.mapper-locations</code>来配置Mybatis的mapper.xml文件路径. </p><p>我在一开始配置的值是<code>mybatis.mapper-locations=classpath:mapper/*Mapper.xml</code>, 这个配置值存在的问题是, 如果在classpath的mapper文件夹中检查到了任意的Mapper.xml文件时, 都会返回结果停止往下继续匹配. 这里的问题是, 我依赖我同事的工程中, 也需要扫描classpath下他的Mapper.xml文件, 而此时无法找到他工程里的Maper.xml文件, 原因就是因为匹配到我工程里classpath中的Mapper.xml文件就停止了对他工程的匹配搜索. 解决的办法是将<code>classpath:mapper/*Mapper.xml</code>改为<code>classpath*:mapper/*Mapper.xml</code>. <code>classpath*</code>的作用是找到包括你依赖的jar文件在内的classpath中的资源文件.</p><p>本来想仔细探究一下这其中的究竟, 但因工作繁忙无暇深入去探索, 暂且记录一下留作以后参考.<br>上网看了一下别人的博客, 介绍的classpath和classpath*的大概区别如下:<br><a href="https://blog.csdn.net/kkdelta/article/details/5507799" target="_blank" rel="noopener">https://blog.csdn.net/kkdelta/article/details/5507799</a><br><a href="http://kyfxbl.iteye.com/blog/1675362" target="_blank" rel="noopener">http://kyfxbl.iteye.com/blog/1675362</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记一下在开发时出现的一个问题, 弄了很久才得到解决.&lt;br&gt;网上查询到的回答大概都是如这篇文章回答的一样来解决 &lt;a href=&quot;https://www.jianshu.com/p/800fe918cc7a&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.jianshu.com/p/800fe918cc7a&lt;/a&gt;&lt;br&gt;但进行操作后依旧未能解决我的问题.&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
      <category term="Mybatis" scheme="http://bennie.im/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>ps安装及破解过程</title>
    <link href="http://bennie.im/2018/05/21/ps-cs6-install-and-crack/"/>
    <id>http://bennie.im/2018/05/21/ps-cs6-install-and-crack/</id>
    <published>2018-05-21T14:56:13.000Z</published>
    <updated>2018-12-29T08:18:28.625Z</updated>
    
    <content type="html"><![CDATA[<p>经常有一些对PS感兴趣的朋友，问我PS怎么下载安装。因为PS是收费的，安装后还需要破解，步骤还是有些麻烦的，这里我写了个安装过程记录一下步骤，也给其它需要的朋友参考。</p><p><strong>首先下载PS的安装包和破解文件, Adobe Photoshop CS6百度网盘下载地址: </strong> 链接: <a href="https://pan.baidu.com/s/1KCj9afywLdmL3J63r70QuQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1KCj9afywLdmL3J63r70QuQ</a> 密码: nsgb</p><a id="more"></a><p>打开网盘链接后，把这两个文件下载下来。<br><img src="/images/2018-05-29-173621.jpg" alt=""></p><blockquote><p><strong>提醒：</strong> 百度网盘下载有限速问题，会导致下载速度比较慢，可以看这里的方法进行解决：<a href="https://github.com/high-speed-downloader/high-speed-downloader" target="_blank" rel="noopener">https://github.com/high-speed-downloader/high-speed-downloader</a></p></blockquote><p>下载后，把压缩包都解压成文件夹。<br><img src="/images/2018-05-29-173623.jpg" alt=""></p><p>左边的是破解程序的文件夹，右边是ps软件本身的安装文件夹。</p><p><strong>下面是安装及破解步骤，先来安装PS软件本身。</strong></p><ol><li>找到ps软件的安装程序。依次打开找到<strong>Set-up.exe</strong><br><img src="/images/2018-05-29-173624.jpg" alt=""></li></ol><ol start="2"><li>打开后显示这样子，点击忽略就行了。<br><img src="/images/2018-05-29-173625.jpg" alt=""><br><img src="/images/2018-05-29-173626.jpg" alt=""></li></ol><ol start="3"><li>这时候选择<strong>试用</strong><br><img src="/images/2018-05-29-173627.jpg" alt=""></li></ol><ol start="4"><li><p>接下来点击<strong>接受</strong>，再点击<strong>登录</strong>后出来登录界面。<br>输入账号密码，然后点击登录<br>账号: <a href="mailto:keitpyocshe@hotmail.com" target="_blank" rel="noopener">keitpyocshe@hotmail.com</a><br>密码:ITpegsItEimKee3<br>点登录后可能有点慢，因为要去连接的国外的服务器验证账号密码的正确性。<br><img src="/images/2018-05-29-173628.jpg" alt=""><br>这里点击<strong>跳过</strong></p></li><li><p>接下来选择安装位置进行安装就行了，<strong>安装位置建议选择安装到D盘。</strong><br><font color="red">安装的地方要记住，后面还会用到的。</font><br><img src="/images/2018-05-29-173629.jpg" alt=""></p></li><li><p>安装完成之后可以在桌面上找到ps的图标，如果桌面上没有，也可以在开始菜单中找到ps的图标<br><img src="/images/2018-05-29-173631.jpg" alt=""><br>随便选择一个打开，然后说是处于试用期。点击<strong>开始试用</strong>就可以了。<br><img src="/images/2018-05-29-173632.jpg" alt=""></p></li></ol><hr><p>这样就完成安装了，下面开始破解，<font color="red">在开始破解之前记得关掉刚才打开的PS软件。</font></p><ol><li><p><strong>找到破解程序的文件夹</strong>，文件夹里的文件大概是这样子的。<br><img src="/images/2018-05-29-173633.jpg" alt=""><br><img src="/images/2018-05-29-173635.jpg" alt=""></p><ul><li>左边的<strong>Crack.bat</strong>是屏蔽hosts文件地址用的(目的是为了屏蔽ps软件与服务器的通信阻止他验证软件的激活状态)。</li><li>右边的<strong>amtlib.dll</strong>是破解补丁文件。</li></ul><p>先运行一下Crack.bat这个文件，运行的时候记得选择<strong>以管理员的身份运行</strong>(注意: 进行这个步骤时建议暂时退出杀毒软件。)<br><img src="/images/2018-05-29-173636.jpg" alt=""></p></li><li><p>运行后弹出这个黑色窗口，提示按任意键继续后，随便按键盘上一个键关掉这个窗口就行。<br><img src="/images/2018-05-29-173638.jpg" alt=""></p></li><li><p>现在打开ps软件的安装文件夹，比如我上面安装到了这个位置。<br> <img src="/images/2018-05-29-173639.jpg" alt=""><br> <img src="/images/2018-05-29-173640.jpg" alt=""><br> 在安装目录下可以看到有5个文件夹，其中后面的2个文件夹带64 Bit的是64位的软件，不带的是32位。之前的破解补丁分别有32位和64位。<br> <img src="/images/2018-05-29-173641.jpg" alt=""></p></li><li><p>这时候，把它们里面的amtlib.dll文件分别复制到PS安装目录下对应的文件夹中替换掉原来的文件就行了。<br>替换的时候记得选择第一个<strong>“复制和替换”</strong><br><img src="/images/2018-05-29-173642.jpg" alt=""></p></li></ol><p>两个都替换掉之后，再次打开PS软件，这时候就看不到说试用了，这样就破解成功了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经常有一些对PS感兴趣的朋友，问我PS怎么下载安装。因为PS是收费的，安装后还需要破解，步骤还是有些麻烦的，这里我写了个安装过程记录一下步骤，也给其它需要的朋友参考。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;首先下载PS的安装包和破解文件, Adobe Photoshop CS6百度网盘下载地址: &lt;/strong&gt; 链接: &lt;a href=&quot;https://pan.baidu.com/s/1KCj9afywLdmL3J63r70QuQ&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://pan.baidu.com/s/1KCj9afywLdmL3J63r70QuQ&lt;/a&gt; 密码: nsgb&lt;/p&gt;
    
    </summary>
    
      <category term="工具" scheme="http://bennie.im/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="PS" scheme="http://bennie.im/tags/PS/"/>
    
  </entry>
  
  <entry>
    <title>2018.05.17&amp;18 EB拓展训练日志——感受与收获</title>
    <link href="http://bennie.im/2018/05/18/Feeling-and-growth-in-the-EB-Expand-training/"/>
    <id>http://bennie.im/2018/05/18/Feeling-and-growth-in-the-EB-Expand-training/</id>
    <published>2018-05-17T16:31:56.000Z</published>
    <updated>2018-12-29T08:18:28.625Z</updated>
    
    <content type="html"><![CDATA[<p>前两天（18.05.17&amp;18）参加了公司安排的拓展式学习，参加了4个主项目，还有1个17日晚饭后的游戏节目。目的是增强自我认知，了解自己在团队中的角色地位，培养团队合作意识等。总得来说，在这2天的收获还是有一些的。</p><p><img src="/images/2018-05-29-173700.jpg" alt=""></p><a id="more"></a><p>回想这两天的经历，更多让我感受到的是这两天的意义是在于让我们更好的去认知自己，通过真实的切身体验去学习、去锻炼、去提升。在这次体验中观察到也学习到很多团队中真正欠缺的与应该所具备的。团队需要一个合格的领导者，团队中有各色的人，人与人之间存在差异与个性，这就会产生包括但不限存在于沟通、理解、执行、配合以及因情绪上等问题。<strong>我想最一开始，因为陌生因为不了解，我们没有选择愿意去服从谁、相信谁、放心谁。</strong>我认为团队真正需要的是一名有能力、具备让大家信服的能力并能够担当的人去进行领导，懂得去管理组织团队，协调团队里每个人员的的相互配合。在此基础上同样重要的一点是团队里的每个人也要具备相互信任及合作的意识。做到抛开个人情感、性格因素等个性化差异真正的进入角色融入到团队中。<strong>这正是在职场或者与其他团队活动时所需要达到的，如果我们可以更好的管理个人情绪、情感去面对身边的人一起去做一些事，也许我们就会变得优秀许多。</strong></p><p><img src="/images/2018-09-12-051430.jpg" alt="1"></p><p>17号白天下午我们进行了一个项目，一共分为6个小组分别参与项目比赛，根据地图以及指北针进行定向越野，从地图上的起始点进行到终点，在地图上一共有8个点需要进行签到，我们要做到在每一次签到后都需要确认到达下一个签到点的方向。项目中只提供了两个工具——指北针和地图。我们需要借这两样工具来完成项目进行越野。其实说句实话，完成项目不是很难，从起点到达终点也不是重要的地方。</p><p><img src="/images/2018-05-29-173727.png" alt="image-20180524103018860"><br><img src="/images/2018-09-12-051531.png" alt="3"></p><p>我想说的是，重在过程，回想我们在完成每一个签到点即将进行下一次跋涉时，我们会存在迷茫、争议、怀疑、犹豫等等各种复杂的情绪及体验。当我们到达地图上的某个十字路口，摆在我们的面前有很多条道路，这时候我们会有不同的选择，但与此同时，随之而来伴随我们的是迷茫与不未知。而此时，我们是一个有着五六个人的小组，也许领队的伙伴会带领你选择某条道路，帮你确定答案解决你的疑惑，但也会因不同的人有不同的意见充满着争议。其实通过这个项目，令我感受最深也让我想到最多的是关于我们人生道路的问题。我们从起点经过一系列的艰辛到达我们最终的终点，其实这更对称了一句有始有终的话。我们知道从何开始，也知道要去往何处，但重在过程。<strong>在过程中，我们每一次面对路口又或是我们完成了一次打卡要开始下一段路程时，就像是我们人生中要面临选择的时候，我充满着迷茫、为知以及因为未知而感受到的一丝恐惧，在我们的人生中，如果我们没有指北针，没有地图，也没有身边的伙伴的情况下，我们是否能够做出正确的判断去选择我们的人生道路，我们又是否有勇气去迈出我们的步伐。</strong>同样地，无论我们路过了哪些风景美丽的地方又或是因身体疲惫我们想要放弃前行，我们都依然只能选择继续前行；无论我们脚底下是平坦还是坎坷，我们都要脚踏实地走好每一步，直至我们到达终点。</p><p><img src="/images/2018-09-12-051606.jpg" alt="4"></p><p>越野项目结束后，我记得赵老师给我们讲话时，用“谈恋爱的道理”来给我们讲职场中的规则，我很认同这一点的适用性。在工作中，你想要在同事、领导面前被认同，你就要将自己的优势，自己好的一面展现给别人，换句话说你要让对方明白你的价值所在。其实，不光是工作，在人际交往中也同样如此。总听人说友情是建立在利益至上，虽不绝对如此，但就观点来说，如果你能够主动帮助别人让别人感受到你的价值所在，那才会是别人愿意同你交往、愿意需要你的理由。</p><p>赵老师期间还提到一句话——<strong>那些在你人生中的挫折、困难、坎坷以及糟糕的事，才是让你铭记于心难以忘记的真正对你有用的。</strong>回想起这句话，我想到是在我们人生不难免会遇到各种各样的困难、挑战、挫折等，但如果我们不是去逃避而是报以坦然以及自律的心态去面对它们去解决它们时，我们会收获更多的成长与快乐幸福。</p><p><img src="/images/2018-09-12-051626.png" alt="5"></p><p>17号晚饭后做了一个游戏，事后也令我有一些感触，尤其过程中一个同事的行为以及后来赵老师的一番话。游戏是将参与者分成两队，每队的人分成一列前后对齐站整齐，要求从最后的人将所接收到的数字告知队伍最前面的人。针对游戏设定了一系列的规则，来增加游戏难度，比如不能说话，不能移动位置等一些限制性的规则。说实话，在游戏的时候我是没有想要去挑战规则或者说根本没去想做一些规则以外的事情。直至游戏最终结束，其实带给我们的是，<strong>我们总是被规则限制，而固化了思维，没有想去改变什么的，我们墨守成规，却忽略了在条件允许的情况下达到结果达到目的最直接最简单的方法。</strong>我想这是值得我所反思的。借着聊天，赵老师还讲到了一个人际交往中的“白金法则”，强调的是在人际交往中，我们要真诚去对待对方，这样才能被对方肯定，对方自然也会这样回应你。这令我想到，很多事都可以从相对的角度作为出发点去考虑，你想要变得幸福，你就要做让自己觉得幸福的事；你想要拥有优秀美好的东西，你就要把自己变得优秀卓越；你想要别人爱你，真诚地对待你，你就要真诚的去对待去爱对方。</p><p><img src="/images/2018-09-12-051733.png" alt="image-20180524103135694"></p><p><img src="/images/2018-09-12-051746.png" alt="image-20180524103157897"></p><p>回想这两天还想说一件让我很开心的事，那就是我的一位同事兼我的好友。我在他身上算是学到不少东西或者说他带给我的。用我之前的一句话说社会是一个大学堂，每个人都能教会你一些东西，那么我想说他就算一位。也不知道是在听了赵老师给我们讲话时提到的我们应该多开放一些自己的内心还是因白天的体验是我之前从未经历过让我很愉悦的原因，当晚我跟他聊了很多，有关于人生想法的、关于做人、关于以前生活的等诸多方面，只记得聊得很晚，我们也彼此分享很多过去的经历、心事，并去理解对方，针对问题给对方解决的建议、指点等等。这是至今以来从未拥有的畅快感，是那种找到知心好友，是那种堵在你内心不知道该找谁诉说又担心说出口会无人理解的事情得以说出口被理解的感觉。我以前是那种挺宅的人，平时很喜欢一个人把事情放在心里想，也从未找到一个合适的朋友与时机去与人诉说。这次的聊天是令我很开心也令我多少有一些收获。我是那种平时会反思自己以及生活的人，我想要过平凡的生活却不想活得平淡，即使现在的我很普通也不足够优秀，但我一直都未曾想要停止变得优秀的脚步。值得开心的是，我在这位好友的身上也发现了这一点，这是令我很欣赏的地方。</p><p>在这次的体验式学习中，让我认识到自己很多问题，比如最基本的团队合作能力，无法做到把自己真正融入到团队中的，放不开以及由于陌生带来的隔阂感，不自信以及与人沟通交往能力，没有那种很自然的与人沟通，没有去开口主动了解别人，借赵老师的话来说甚至连基本的组员的姓名都不曾去问过。这些都是在今后需要努力去改变去解决的问题。我想我可能需要更多的此类活动来对自己有更好地认知，使自己得到提升锻炼以及慢慢将自己放开融入集体的团队活动中。 </p><p>最后，这两天，其实真的比较开心，身心上很愉悦。在这里感谢这两天活动中所有的领导、老师以及相关事物的负责人员。感谢您们提供可口美味的饭菜、选择风景的美好的地方进行培训以及安排了舒适的住宿条件。也感谢在一起合作的一群人，很开心能够与你们一同参与活动，让我能够得以学习并拥有以前从未有过的体验以及新鲜感。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前两天（18.05.17&amp;amp;18）参加了公司安排的拓展式学习，参加了4个主项目，还有1个17日晚饭后的游戏节目。目的是增强自我认知，了解自己在团队中的角色地位，培养团队合作意识等。总得来说，在这2天的收获还是有一些的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-05-29-173700.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="生活" scheme="http://bennie.im/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="拓展训练" scheme="http://bennie.im/tags/%E6%8B%93%E5%B1%95%E8%AE%AD%E7%BB%83/"/>
    
      <category term="体验式学习" scheme="http://bennie.im/tags/%E4%BD%93%E9%AA%8C%E5%BC%8F%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>A标签onclick事件取消默认行为</title>
    <link href="http://bennie.im/2017/11/24/onclick-event-on-an-a-element/"/>
    <id>http://bennie.im/2017/11/24/onclick-event-on-an-a-element/</id>
    <published>2017-11-24T13:16:01.000Z</published>
    <updated>2018-12-29T08:13:04.813Z</updated>
    
    <content type="html"><![CDATA[<p>在开发中，经常会碰到为a标签绑定单击事件，由于a标签默认有跳转的行为，所以会影响到我们的onclick事件的处理代码。</p><p>我们需要屏蔽掉他的默认行为，下面是一些常用的方式。</p><a id="more"></a><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>方式1: href="Javascript:void(0)"<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"Javascript:void(0)"</span> <span class="attr">onclick</span>=<span class="string">"alert('方式1, 执行一段代码.')"</span>&gt;</span>情刑1: 执行一段代码.<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"Javascript:void(0)"</span> <span class="attr">onclick</span>=<span class="string">"popup()"</span>&gt;</span>情刑2: 调用一个已声明的js函数.<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"Javascript:void(0)"</span> <span class="attr">id</span>=<span class="string">"manual_bind_click_way1"</span>&gt;</span>情形3: 手动绑定click事件<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>方式2: onclick="return false;"<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.google.com"</span> <span class="attr">onclick</span>=<span class="string">"alert('方式1, 执行一段代码.'); return false;"</span>&gt;</span>情刑1: 执行一段代码.<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.google.com"</span> <span class="attr">onclick</span>=<span class="string">"popup(); return false;"</span>&gt;</span>情刑2: 调用一个已声明的js函数.<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.google.com"</span> <span class="attr">id</span>=<span class="string">"manual_bind_click_way2"</span>&gt;</span>情刑3: 手动绑定click事件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 已声明函数popup</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">popup</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">"弹窗测试."</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">      <span class="comment">// 手动绑定click</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> aEle_way1 = <span class="built_in">document</span>.getElementById(<span class="string">"manual_bind_click_way1"</span>); <span class="comment">// 方式1 a标签.</span></span></span><br><span class="line"><span class="javascript">        aEle_way1.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"手动绑定click事件."</span>);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> aEle_way2 = <span class="built_in">document</span>.getElementById(<span class="string">"manual_bind_click_way2"</span>); <span class="comment">// 方式2 a标签.</span></span></span><br><span class="line"><span class="javascript">        aEle_way2.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">"手动绑定click事件."</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在实现上大概有两种方式：</p><ol><li><strong>方式1:</strong> 为href属性添加<code>Javascript:void(0)</code>来<strong>构造伪链接, </strong>即为：<code>href=&quot;Javascript:void(0)&quot;</code></li><li><strong>方式2:</strong> 添加onclick属性并在事件处理代码中通过<code>return false;</code>来<strong>屏蔽默认行为</strong>, 即为：<code>onclick=&quot;return false;&quot;</code>(<strong>这种方式表示希望保留href属性的内容</strong>.)</li></ol><p>这两种方式都会直接的<strong>屏蔽跳转行为</strong>.</p><hr><p>我们在开发中可能会遇到如下3种情形, 比如说</p><ol><li>单击a标签后, 执行一段js代码. (<strong>如情形1</strong>)</li><li>单击a标签后, 调用js中已经声明的函数. (<strong>如情形2</strong>, 这种情况大家一般传递this对象, 即: <code>onclick=&quot;popup(this)&quot;</code>)</li><li>我们想要手动为a标签绑定单击事件, 但是在事件执行后依然不希望a标签跳转. (<strong>如情形3</strong>)</li></ol><p>需要说明的是如果以方式2的来实现情形3, 那么需要onclick事件处理最后返回false, 即return false, 否则执行完click事件后依然会跳转.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在开发中，经常会碰到为a标签绑定单击事件，由于a标签默认有跳转的行为，所以会影响到我们的onclick事件的处理代码。&lt;/p&gt;
&lt;p&gt;我们需要屏蔽掉他的默认行为，下面是一些常用的方式。&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://bennie.im/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="http://bennie.im/tags/Javascript/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Netflix多语言/非java语言支持Sidecar</title>
    <link href="http://bennie.im/2017/09/12/polyglot-support-with-sidecar/"/>
    <id>http://bennie.im/2017/09/12/polyglot-support-with-sidecar/</id>
    <published>2017-09-12T04:09:27.000Z</published>
    <updated>2018-12-29T08:13:04.827Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>公司有一个调研要做，调研如何将Python语言提供的服务纳入到Spring Cloud管理中来，找到了这个Sidecar组件，发现官方提供一篇文档如下，对其进行相关翻译。</p><h3 id="Sidecar简介"><a href="#Sidecar简介" class="headerlink" title="Sidecar简介"></a>Sidecar简介</h3><p>根据我的理解，Sidecar是作为一个代理的服务来间接性的让其他语言可以使用Eureka等相关组件。通过与Zuul的来进行路由的映射，从而可以做到服务的获取，然后可以使用Ribbon，Feign对服务进行消费，以及对Config Server的间接性调用。(此段内容仅个人理解，只作为参考，欢迎讨论，同时有误请及时指正。)</p><a id="more"></a><h3 id="正文翻译"><a href="#正文翻译" class="headerlink" title="正文翻译"></a>正文翻译</h3><p>以下是原文翻译，原文地址：<a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi__polyglot_support_with_sidecar.html" target="_blank" rel="noopener">https://cloud.spring.io/spring-cloud-netflix/multi/multi__polyglot_support_with_sidecar.html</a></p><p>你是否想要在非jvm的语言中利用（间接性使用）Eureka，Ribbon以及Config Server？Spring Cloud Netflix Sidecar的设计灵感来自<a href="https://github.com/Netflix/Prana" target="_blank" rel="noopener">Netflix Prana</a>。它包含一个简单的http api去获取一个已知服务的所有实例(例如主机和端口)。你也可以通过嵌入的Zuul代理(Zuul中有一个代理功能)对代理的服务进行调用，Zuul从Eureka服务注册中心获取所有的路由记录(route entries)。通过host发现(host lookup)或者Zuul代理可以直接访问Spring Cloud Config。非jvm应用应该实现一个健康检查，Sidecar能够以此来报告给Eureka注册中心该应用是up还是down状态。</p><p>在你的项目中使用Sidecar，需要添加依赖，其group为<code>org.springframework.cloud</code>，artifact id为<code>spring-cloud-netflix-sidecar</code>。(这是以maven依赖的方式)</p><p>启用Sidecar，创建一个Spring Boot应用程序，并在在应用主类上加上<code>@EnableSidecar</code>注解。该注解包含<code>@EnableCircuitBreaker</code>, <code>@EnableDiscoveryClient</code>以及<code>@EnableZuulProxy</code>。Run the resulting application on the same host as the non-jvm application. (这句不太会翻译，我的理解为：在与非jvm应用程序相同的主机上运行生成的应用程序)注：这里的生成应该是通过代理产生的服务。</p><p>配置Sidecar，在application.yml中添加<code>sidecar.port</code>和<code>sidecar.health-uri</code>。<code>sidecar.port</code>属性是非jre程序监听的端口号，这就是Sidecar可以正确注册应用到Eureka的原因。<code>sidecar.health-uri</code>是非jre应用提供的一个对外暴露的可访问uri地址，在该地址对应的接口中需要实现一个模仿Spring Boot健康检查指示器的功能。它需要返回如下的json文档。(<strong>注</strong>：通过返回一个json，其用status字段来标识你的应用的服务状态，是up还是down，sidecar会将该状态报告给eureka注册中心从而实现你的服务的状态可用情况。<strong>简单的说就是用来控制sidecar代理服务的状态！</strong>)<br>health-uri-document. </p><p><strong>health-uri-document.</strong>(heal-uri指向的接口地址需要返回的json文档)<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>:<span class="string">"UP"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里是一个Sidecar应用程序的application.yml配置示例：</p><p><strong>application.yml</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 5678</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: sidecar</span><br><span class="line"></span><br><span class="line">sidecar:</span><br><span class="line">  port: 8000</span><br><span class="line">  health-uri: http://localhost:8000/health.json</span><br></pre></td></tr></table></figure></p><p>API <code>DiscoveryClient.getInstances()</code>所对应的访问方式是<code>/hosts/{serviceId}</code>，这是访问<code>/hosts/customers</code>后的响应示例，它返回了两个不同主机上的实例(可以看到主机地址不一样)。<br>非jre程序可以访问这个api，如果sidecar的端口号为5678，那么完整url则为：<code>http://localhost:5678/hosts/{serviceId}</code>.</p><p><strong>/hosts/customers.</strong><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"host"</span>: <span class="string">"myhost"</span>,</span><br><span class="line">        <span class="attr">"port"</span>: <span class="number">9000</span>,</span><br><span class="line">        <span class="attr">"uri"</span>: <span class="string">"http://myhost:9000"</span>,</span><br><span class="line">        <span class="attr">"serviceId"</span>: <span class="string">"CUSTOMERS"</span>,</span><br><span class="line">        <span class="attr">"secure"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"host"</span>: <span class="string">"myhost2"</span>,</span><br><span class="line">        <span class="attr">"port"</span>: <span class="number">9000</span>,</span><br><span class="line">        <span class="attr">"uri"</span>: <span class="string">"http://myhost2:9000"</span>,</span><br><span class="line">        <span class="attr">"serviceId"</span>: <span class="string">"CUSTOMERS"</span>,</span><br><span class="line">        <span class="attr">"secure"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>Zuul代理会自动为每个在Eureka注册中心上的服务添加路由到<code>/serviceId</code>上，所以上面那个customers的服务可以通过<code>/customers</code>访问。非Jre应用可以通过<code>http://localhost:5678/customers</code>来访问Customer Service(假设Sidecar的监听端口为5678)</p><p>如果Config Server注册到了Eureka，非jre应用就可以通过Zuul代理访问它。如果ConfigServer的serviceId为<code>configserver</code>并且Sidecar的端口为5678，那么可以通过<a href="http://localhost:5678/configserver" target="_blank" rel="noopener">http://localhost:5678/configserver</a> 的方式来访问Config Server。</p><p>非Jvm应用可以利用Config Server的能力来获取Config Server返回的YAML文档，通过访问 <a href="http://sidecar.local.spring.io:5678/configserver/default-master.yml" target="_blank" rel="noopener">http://sidecar.local.spring.io:5678/configserver/default-master.yml</a> 就可以获取到类似下面的YAML文档结果<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8761/eureka/</span></span><br><span class="line"><span class="attr">  password:</span> <span class="string">password</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line"><span class="attr">  description:</span> <span class="string">Spring</span> <span class="string">Cloud</span> <span class="string">Samples</span></span><br><span class="line"><span class="attr">  url:</span> <span class="attr">https://github.com/spring-cloud-samples</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;公司有一个调研要做，调研如何将Python语言提供的服务纳入到Spring Cloud管理中来，找到了这个Sidecar组件，发现官方提供一篇文档如下，对其进行相关翻译。&lt;/p&gt;
&lt;h3 id=&quot;Sidecar简介&quot;&gt;&lt;a href=&quot;#Sidecar简介&quot; class=&quot;headerlink&quot; title=&quot;Sidecar简介&quot;&gt;&lt;/a&gt;Sidecar简介&lt;/h3&gt;&lt;p&gt;根据我的理解，Sidecar是作为一个代理的服务来间接性的让其他语言可以使用Eureka等相关组件。通过与Zuul的来进行路由的映射，从而可以做到服务的获取，然后可以使用Ribbon，Feign对服务进行消费，以及对Config Server的间接性调用。(此段内容仅个人理解，只作为参考，欢迎讨论，同时有误请及时指正。)&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="http://bennie.im/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="微服务" scheme="http://bennie.im/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Spring Cloud" scheme="http://bennie.im/tags/Spring-Cloud/"/>
    
      <category term="Sidecar" scheme="http://bennie.im/tags/Sidecar/"/>
    
  </entry>
  
  <entry>
    <title>使用Sidecar将Node.js引入Spring Cloud</title>
    <link href="http://bennie.im/2017/09/11/using-sidecar-to-integration-with-nodejs-in-springcloud/"/>
    <id>http://bennie.im/2017/09/11/using-sidecar-to-integration-with-nodejs-in-springcloud/</id>
    <published>2017-09-11T09:51:36.000Z</published>
    <updated>2018-12-29T08:18:28.625Z</updated>
    
    <content type="html"><![CDATA[<p>网上看到的一篇文章，觉得写得挺好，现转载于此，以方便需要的网友查阅。<br>该文章介绍了非JAVA语言提供的应用集成到Spring Cloud的这样一个实现，以便我们使用其他语言作为参考。<br><strong>感谢原作者分享，原文链接： <a href="https://github.com/marshalYuan/spring-cloud-example/blob/master/docs/sidecar.md" target="_blank" rel="noopener">https://github.com/marshalYuan/spring-cloud-example/blob/master/docs/sidecar.md</a></strong></p><a id="more"></a><p>注：其中图片如果看不清，可以右键新窗口打开查看大图。</p><hr><h1 id="使用Sidecar将Node-js引入Spring-Cloud"><a href="#使用Sidecar将Node-js引入Spring-Cloud" class="headerlink" title="使用Sidecar将Node.js引入Spring Cloud"></a>使用Sidecar将Node.js引入Spring Cloud</h1><h2 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Spring Cloud是目前非常流行的微服务化解决方案，它将Spring Boot的便捷开发和Netflix OSS的丰富解决方案结合起来。如我们所知，Spring Cloud不同于Dubbo，使用的是基于HTTP(s)的Rest服务来构建整个服务体系。</p><p>那么有没有可能使用一些非JVM语言，例如我们所熟悉的Node.js来开发一些Rest服务呢？当然是可以的。但是如果只有Rest服务，还不能接入Spring Cloud系统。我们还想使用起Spring Cloud提供的Eureka进行服务发现，使用Config Server做配置管理，使用Ribbon做客户端负载均衡。这个时候Spring sidecar就可以大显身手了。</p><p>Sidecar起源于<a href="https://github.com/Netflix/Prana" target="_blank" rel="noopener">Netflix Prana</a>。他提供一个可以获取既定服务所有实例的信息(例如host，端口等)的http api。你也可以通过一个嵌入的Zuul，代理服务到从Eureka获取的相关路由节点。Spring Cloud Config Server可以直接通过主机查找或通过代理Zuul进行访问。</p><p>需要注意的是你所开发的Node.js应用，必须去实现一个健康检查接口，来让Sidecar可以把这个服务实例的健康状况报告给Eureka。</p><p>为了使用Sidecar，你可以创建一个带有<code>@EnableSidecar</code>注解的Spring Boot程序。我们来看下这个注解都干了什么：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Enable</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import</span>(SidecarConfiguration.class)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableSidecar &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看，hystrix的熔断器、Eureka的服务发现、zuul代理，这些该有的部件，都已经开启。</p><h3 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h3><p>接下来需要在application.yml里加入<code>sidecar.port</code>和<code>sidecar.health-uri</code>的配置。其中<code>sidecar.port</code>属性代表这个Node.js应用监听的端口。这是为了让sidecar可以正常的注册到Eureka服务中。<code>sidecar.health-uri</code>是一个用来模拟Spring Boot应用健康指标的接口的uri。它必须返回如下形式的json文档：<br><code>health-uri-document</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"status"</span>:<span class="string">"UP"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整个Sidecar应用的<code>application.yml</code>如下：<br><code>application.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">5678</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">sidecar</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sidecar:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8000</span></span><br><span class="line"><span class="attr">  health-uri:</span> <span class="attr">http://localhost:8000/health.json</span></span><br></pre></td></tr></table></figure><h3 id="服务访问"><a href="#服务访问" class="headerlink" title="服务访问"></a>服务访问</h3><p>构建完这个应用，你就可以使用<code>/hosts/{serviceId}</code>这个API来获取<code>DiscoveryClient.getInstances()</code>的结果。这里有一个从<code>/hosts/customers</code>返回两个来自不同host的实例信息的例子。如果sidebar运行在5678端口， 那么Node.js应用是可以通过<a href="http://localhost:5678/hosts/{serviceId}" target="_blank" rel="noopener">http://localhost:5678/hosts/{serviceId}</a>访问这个api的。</p><p><code>/hosts/customers</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"host"</span>: <span class="string">"myhost"</span>,</span><br><span class="line">        <span class="attr">"port"</span>: <span class="number">9000</span>,</span><br><span class="line">        <span class="attr">"uri"</span>: <span class="string">"http://myhost:9000"</span>,</span><br><span class="line">        <span class="attr">"serviceId"</span>: <span class="string">"CUSTOMERS"</span>,</span><br><span class="line">        <span class="attr">"secure"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"host"</span>: <span class="string">"myhost2"</span>,</span><br><span class="line">        <span class="attr">"port"</span>: <span class="number">9000</span>,</span><br><span class="line">        <span class="attr">"uri"</span>: <span class="string">"http://myhost2:9000"</span>,</span><br><span class="line">        <span class="attr">"serviceId"</span>: <span class="string">"CUSTOMERS"</span>,</span><br><span class="line">        <span class="attr">"secure"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Zuul proxy可以自动每一个注册到Eureka的关联到<code>/&lt;serviceId&gt;</code>的服务添加路由，因此customer服务是可以通过<code>/customers</code>这个URI访问的。同样假定sidecar监听在5678端口，这样我们的Node.js应用就可以通过<a href="http://localhost:5678/customers" target="_blank" rel="noopener">http://localhost:5678/customers</a>访问这个customer服务。</p><h3 id="Config-Server"><a href="#Config-Server" class="headerlink" title="Config Server"></a>Config Server</h3><p>如果我们使用了Config Server服务，并且把它注册到Eureka，Node.js应用就可以通过Zull Proxy来访问它。如果ConfigServer的serviceId是<code>configserver</code>并且Sidecar监听在5678端口，然后就可以通过<a href="http://localhost:5678/configserver" target="_blank" rel="noopener">http://localhost:5678/configserver</a>来访问Config Server。当然这也得益于Eureka，Config Server都提供了基于HTTP协议的Rest接口。</p><p>Node.js应用也可以利用Config Server的能力获取一些如YAML格式的配置文档。例如，一个对<a href="http://sidecar.local.spring.io:5678/configserver/default-master.yml" target="_blank" rel="noopener">http://sidecar.local.spring.io:5678/configserver/default-master.yml</a>的访问，可能获得如下的YAML文档的返回：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8761/eureka/</span></span><br><span class="line"><span class="attr">  password:</span> <span class="string">password</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line"><span class="attr">  description:</span> <span class="string">Spring</span> <span class="string">Cloud</span> <span class="string">Samples</span></span><br><span class="line"><span class="attr">  url:</span> <span class="attr">https://github.com/spring-cloud-samples</span></span><br></pre></td></tr></table></figure><p>所以将Node.js应用通过Sidecar接入Spring Cloud微服务集群的整体架构，大致就如下图:</p><p><img src="/images/2018-05-29-173644.png" alt=""></p><h2 id="demo实践"><a href="#demo实践" class="headerlink" title="demo实践"></a>demo实践</h2><p>我们假设下有这样一个非常简单的数据，它叫User：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看起来非常经典哈！</p><p>还有一个数据结构是用来表示书的，Book：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String publishDate;</span><br><span class="line">    <span class="keyword">private</span> String des;</span><br><span class="line">    <span class="keyword">private</span> String ISBN;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Book中的authorId对应User的id，现在我们要为这两种数据开发Rest服务了。</p><p>首先是User，我们使用spring来开发，先在controller的构造方法里，mock一些假数据users，然后非常简单的一个根据id查用户的Get接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(@PathVariable Long id)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>启动后，我们curl访问下：</p><pre><code>curl localhost:8720/12{&quot;id&quot;:12,&quot;username&quot;:&quot;user12&quot;,&quot;age&quot;:16}</code></pre><p>接下来，我们使用Node.js开发Book相关的接口。</p><p>由于Node.js社区十分活跃，可选的Rest服务框架非常多。比较主流的有<code>express</code>，<code>koa</code>, <code>hapi</code>等，非常轻量易扩展的也有像<code>connect</code>这样的，这里笔者考虑到群众基础和文档丰富度，选择使用<a href="https://expressjs.com/" target="_blank" rel="noopener">express</a>来开发这样一个可以接入Spring Cloud的Rest服务。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> faker = <span class="built_in">require</span>(<span class="string">'faker/locale/zh_CN'</span>)</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">'morgan'</span>)</span><br><span class="line"><span class="keyword">const</span> services = <span class="built_in">require</span>(<span class="string">'./service'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">100</span></span><br><span class="line"><span class="keyword">const</span> books = <span class="keyword">new</span> <span class="built_in">Array</span>(count)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    books[count] = &#123;</span><br><span class="line">        id: count,</span><br><span class="line">        name: faker.name.title(),</span><br><span class="line">        authorId: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">100</span>) + <span class="number">1</span>,</span><br><span class="line">        publishDate: faker.date.past().toLocaleString(),</span><br><span class="line">        des: faker.lorem.paragraph(),</span><br><span class="line">        ISBN: <span class="string">`ISBN 000-0000-00-0`</span></span><br><span class="line">    &#125;</span><br><span class="line">    count --</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(logger(<span class="string">'combined'</span>))</span><br><span class="line"><span class="comment">//服务健康指标接口</span></span><br><span class="line">app.get(<span class="string">'/health'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">        status: <span class="string">'UP'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/book/:id'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">parseInt</span>(req.params.id)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isNaN</span>(id))&#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">    res.json(books[id])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//....</span></span><br></pre></td></tr></table></figure><p>也是先用<a href="https://github.com/marak/Faker.js/" target="_blank" rel="noopener">faker</a>来mock100条数据,然后写一条简单的get路由。</p><p>启动后，我们用浏览器访问下<a href="http://localhost:3000/book/1" target="_blank" rel="noopener">http://localhost:3000/book/1</a><br><img src="/images/2018-05-29-173645.png" alt=""></p><p>现在我们已经有了两个微服务，接下来我们启动一个Sidecar实例，用于将Node.js接入Spring Cloud。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableSidecar</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SidecarApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SidecarApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>非常简单，需要注意的是，在这之前，你需要一个eureka-server，为了测试sidecar代理访问Spring Config的能力，我还使用了config-server，相信熟悉spring cloud的同学应该都知道吧。</p><p>在sidecar的配置中，bootstrap.yaml中就是简单指定下服务端口跟config-server的地址,而<code>node-sidecar.yaml</code>配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="string">$&#123;EUREKA_SERVICE_URL:http://localhost:8700/eureka/&#125;</span></span><br><span class="line"><span class="attr">sidecar:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">  home-page-uri:</span> <span class="attr">http://localhost:$&#123;sidecar.port&#125;/</span></span><br><span class="line"><span class="attr">  health-uri:</span> <span class="attr">http://localhost:$&#123;sidecar.port&#125;/health</span></span><br><span class="line"></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line"><span class="attr">  command:</span></span><br><span class="line"><span class="attr">    default:</span></span><br><span class="line"><span class="attr">      execution:</span></span><br><span class="line"><span class="attr">        timeout:</span></span><br><span class="line"><span class="attr">          enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>这里指定了sidecar所指向的node.js服务的地址,<code>hystrix.command.default.execution.timeout.enabled: false</code>主要是因为sidecar使用了hystrix的默认为一秒的超时熔断器，国内访问github的速度你懂的，我在测试时访问config-server经常超时，所以我就把它跟disable掉了，你也可以选择把超时时间配长一点。</p><p>将eureka-server，config-server，user-service，node-sidecar, node-book-service都启动后，我们打开eureka的主页面<a href="http://localhost:8700/" target="_blank" rel="noopener">http://localhost:8700/</a>：<br><img src="/images/2018-05-29-173647.png" alt=""></p><p>看到我们的服务都处于UP状态，说明一切正常。接下来在看看Node.js应用的控制台：<br><img src="/images/2018-05-29-173650.png" alt=""></p><p>发现已经有流量打进来了，访问的接口是<code>/health</code>，很明显这就是node-sidecar对我们的node应用进行健康检查的调用。</p><p>接下来就是见证奇迹的时刻了，我们curl访问sidecar的8741端口:</p><pre><code>curl localhost:8741/user-service/12{&quot;id&quot;:12,&quot;username&quot;:&quot;user12&quot;,&quot;age&quot;:16}</code></pre><p>跟直接访问user-service结果一致，说明sidecar的Zuul Proxy可以将我们的请求代理到user-service服务。</p><p>好了，借助这个代理，我们希望book服务能够提供作者信息的接口：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SIDECAR = &#123;</span><br><span class="line">    uri: <span class="string">'http://localhost:8741'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> USER_SERVICE = <span class="string">'user-service'</span></span><br><span class="line"><span class="keyword">const</span> getUserById = <span class="function">(<span class="params">id</span>) =&gt;</span> fetch(<span class="string">`<span class="subst">$&#123;SIDECAR.uri&#125;</span>/<span class="subst">$&#123;USER_SERVICE&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>).then(<span class="function">(<span class="params">resp</span>)=&gt;</span>resp.json())</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/book/:bookId/author'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> bookId = <span class="built_in">parseInt</span>(req.params.bookId)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isNaN</span>(bookId))&#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> book = books[bookId]</span><br><span class="line">    <span class="keyword">if</span>(book) &#123;</span><br><span class="line">        <span class="keyword">let</span> uid = book.authorId</span><br><span class="line">        services.getUserById(uid).then(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(user.id) &#123;</span><br><span class="line">                res.json(user)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"user not found"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span> next(error))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据uid，filter出authorId为uid的所有书</span></span><br><span class="line">app.get(<span class="string">'/books'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> uid = req.query.uid</span><br><span class="line">    res.json(books.filter(<span class="function">(<span class="params">book</span>)=&gt;</span>book.authorId == uid))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>我们访问下<a href="http://localhost:3000/book/2/author" target="_blank" rel="noopener">http://localhost:3000/book/2/author</a>,可以看到返回了bookId为2的作者信息。但是这里有一个问题，我们并不能像代理到user-service那样通过访问<a href="http://localhost:8741/node-sidecar/book/1" target="_blank" rel="noopener">http://localhost:8741/node-sidecar/book/1</a>来访问Node.js的接口，那么怎么让user-service拿到book-service的数据呢？看下最开始的理论知识部分，我们可以通过访问<code>/hosts/&lt;serviceId&gt;</code>获取到各个服务的相关信息，我们来试下访问<a href="http://localhost:8741/hosts/node-sidecar" target="_blank" rel="noopener">http://localhost:8741/hosts/node-sidecar</a>得到如下结果：<br><img src="/images/2018-05-29-173653.png" alt=""></p><p>可以看到返回信息里有Node.js应用的uri等信息，那么是不是我们可以先访问下sidecar的这个接口，拿到真实的uri之后，再来调用book-service的<code>/books?uid=&lt;uid&gt;</code>接口呢？当然可以，事实上spring cloud中已经有工具帮我们做这个事情，就是<code>Feign</code>，新建<code>BookFeighClient.java</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"node-sidecar"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookFeignClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/books"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">findByUid</span><span class="params">(@RequestParam(<span class="string">"uid"</span>)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>FeignClient</code>可以自动根据serviceId去Eureka上找到对应的服务地址，如果该服务的实例不止一个，就会使用Ribbon进行客户端负载均衡，再加上一些像<code>RequestMapping</code>的注解，可以让客户端跟服务端controller保持一致。通过定义的这个<code>findByUid</code>方法，我们就可以轻松调用上面Node.js中定义的<code>/books?uid=&lt;uid&gt;</code>的接口了。这一点儿，也和我们上面画的sidecar架构图一致。</p><p>有了，我们再在user-service中定义这样一个新类型Author，它继承自User，加了一个books字段:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再加入一个获取author的接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/author/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Author <span class="title">getAuthor</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">  List&lt;Book&gt; books = bookFeignClient.findByUid(id);</span><br><span class="line">  User user = findById(id);</span><br><span class="line">  Author author = <span class="keyword">new</span> Author();</span><br><span class="line">  author.setId(user.getId());</span><br><span class="line">  author.setUsername(user.getUsername());</span><br><span class="line">  author.setAge(user.getAge());</span><br><span class="line">  author.setBooks(books);</span><br><span class="line">  <span class="keyword">return</span> author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>逻辑也很简单，获取对应user，根据uid从bookFeignClient获取books，然后构建author返回。</p><p>我们访问下<a href="http://localhost:8720/author/11" target="_blank" rel="noopener">http://localhost:8720/author/11</a>看下返回结果：<br><img src="/images/2018-05-29-173655.png" alt=""></p><p>需要注意由于是随机数据，可能需要换几个authorId才能看到这样的结果。</p><p>好了，到现在为止，我们已经完成了JAVA和Node.js两种语言借助sidecar和通用的http协议完成互相调用的全过程。关于更多的类似从config-server获取配置信息，从Eureka获取应用信息等操作，可以去下载我实验用的源码来了解。</p><p>我把整个DEMO放在了我的github中了，大家可以直接clone下来</p><pre><code>git clone https://github.com/marshalYuan/spring-cloud-example.git</code></pre><p>整个工程大致是这样的：</p><ul><li>eureka-server //对应上图的Eureka Server</li><li>config-server //对应上图的Config Server</li><li>config-repo //config-server仓库地址的searchPath</li><li>user-service //java开发的服务，既是服务提供者(Provider)也是消费者(Coustomer)</li><li>node-sidecar //一个sidecar实例，负责连接node和spring-cloud</li><li>book-service-by-node //express.js开发的Rest服务</li></ul><p>大家可以按照：</p><pre><code>eureka-server -&gt; config-server -&gt; user-service -&gt; book-service-by-node -&gt; node-sidecar</code></pre><p>这样的顺序启动这五个应用，由于是测试用demo，所以有bug我也不管哈。</p><h2 id="写在结尾"><a href="#写在结尾" class="headerlink" title="写在结尾"></a>写在结尾</h2><p>正如开篇所说，得益于通用的Http协议和Netflix丰富的套件，我们可以将很多像Node.js，PHP，Python这样的非JVM语言接入Spring Cloud这个非常成熟的微服务框架，来迅速构建我们的微服务业务系统。你可能会说为什么不都用java呢？确实，一个系统单一语言开发维护成本确实会低很多，但还有一些其他情况值得我们去选择sidecar方案。</p><p>比如，历史包袱太重，想切到java平台，但是又不想完全重写过去的服务，这样就可以以统一协议为代价来进行整合，从java切到其他平台亦是如此。</p><p>还有一个说法叫”拥抱语言红利”，选择一种开发语言就代表选择一种编程思想已经这门开发语言对应的工具和库。比如现在很流行用Python做数据分析，那么微服务系统中这一部分的业务是不是可以用Python开发啊；Node.js的异步事件事件驱动机制很优秀，能不能用它来开发一些需要处理大量异步请求的服务啊；诸如此类。这里确实不是在引发”最优语言圣战”哈，私以为脱离了使用场景和生态来进行语言优劣的比较就是耍流氓。就拿计算100以内的所有<a href="http://baike.baidu.com/view/148142.htm" target="_blank" rel="noopener">勾股数</a>为例，我不觉得有什么语言能像Haskell的代码这样简洁易懂：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ (x,y,z) | x &lt;- [1..100], y &lt;- [x..100], z &lt;- [x..100], x*x + y*y == z*z ]</span><br></pre></td></tr></table></figure><p>再说了，我们标题中选的是Node.js，最好的语言明明是PHP啊！逃~~~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;网上看到的一篇文章，觉得写得挺好，现转载于此，以方便需要的网友查阅。&lt;br&gt;该文章介绍了非JAVA语言提供的应用集成到Spring Cloud的这样一个实现，以便我们使用其他语言作为参考。&lt;br&gt;&lt;strong&gt;感谢原作者分享，原文链接： &lt;a href=&quot;https://github.com/marshalYuan/spring-cloud-example/blob/master/docs/sidecar.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/marshalYuan/spring-cloud-example/blob/master/docs/sidecar.md&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="http://bennie.im/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="微服务" scheme="http://bennie.im/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="Spring Cloud" scheme="http://bennie.im/tags/Spring-Cloud/"/>
    
      <category term="Sidecar" scheme="http://bennie.im/tags/Sidecar/"/>
    
  </entry>
  
  <entry>
    <title>使用其他(非java)语言开发Eureka客户端</title>
    <link href="http://bennie.im/2017/09/06/eureka-rest-operations/"/>
    <id>http://bennie.im/2017/09/06/eureka-rest-operations/</id>
    <published>2017-09-06T09:13:42.000Z</published>
    <updated>2018-12-29T08:13:04.804Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>公司需要调研Eureka在非JAVA语言中的使用，我在Eureka的官方github上找到了一份wiki，是官方提供的Eureka一些REST操作API，其他语言可以使用这些API来实现对Eureka Server的操作从而实现一个非jvm语言的Eureka Client。</p><a id="more"></a><p>这篇博文主要是对Eureka官方的提供的REST操作的WIKI做了翻译，<strong>并没有提供具体的实际案例代码。</strong><br>不过今天（2017-9-20）我在阅读《Spring Cloud与Docker微服务架构实战》书中看到了有这部分的使用说明，其中4.9节介绍了详细使用过程。如果有需要的话可以参考一下。<br>另外如果感兴趣可以看看书中8.11节“使用Sidecar整合非JVM微服务”这部分，关于这部分的内容本人博客也有两篇相关博文：<br><a href="/2017/09/12/polyglot-support-with-sidecar/">Spring Cloud Netflix多语言/非java语言支持之Sidecar</a><br><a href="/2017/09/11/using-sidecar-to-integration-with-nodejs-in-springcloud">使用Sidecar将Node.js引入Spring Cloud</a></p><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><p><strong>Eureka REST operations</strong><br><strong>翻译的版本为David Liu 在2016年2月26编辑的版本。</strong><br>英文原文地址：<a href="https://github.com/Netflix/eureka/wiki/Eureka-REST-operations" target="_blank" rel="noopener">https://github.com/Netflix/eureka/wiki/Eureka-REST-operations</a></p><h3 id="正文翻译"><a href="#正文翻译" class="headerlink" title="正文翻译"></a>正文翻译</h3><p>下面是可用于非JAVA应用的Eureka REST操作。</p><p><strong>appID</strong>是应用程序的名称，<strong>instanceID</strong>是与服务实例相关联的唯一id。在AWS云中，instanceID是服务实例的<strong>实例id</strong>，在其他数据中心(非AWS环境)，它是服务实例的主机名。</p><p>对下面的JSON/XML格式而言，内容的类型必须是<strong>application/xml</strong> 或 <strong>application/json</strong>。</p><hr><table><thead><tr><th style="text-align:left"><strong>操作</strong></th><th style="text-align:left"><strong>HTTP action</strong></th><th style="text-align:left"><strong>描述</strong></th></tr></thead><tbody><tr><td style="text-align:left">注册新的应用实例</td><td style="text-align:left">POST /eureka/v2/apps/<strong>appID</strong></td><td style="text-align:left">接受JSON/XML格式请求，返回204响应码表示成功</td></tr><tr><td style="text-align:left">取消注册(de-register)应用实例</td><td style="text-align:left">DELETE /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong></td><td style="text-align:left">返回响应码200表示成功</td></tr><tr><td style="text-align:left">发送应用实例心跳</td><td style="text-align:left">PUT /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong></td><td style="text-align:left">返回响应码200表示成功，404表示<strong>instanceID</strong>不存在</td></tr><tr><td style="text-align:left">查询所有实例</td><td style="text-align:left">GET /eureka/v2/apps</td><td style="text-align:left">返回响应码200表示成功，响应内容格式JSON/XML</td></tr><tr><td style="text-align:left">为所有<strong>appID</strong>实例做查询(Query for all <strong>appID</strong> instances)</td><td style="text-align:left">GET /eureka/v2/apps/<strong>appID</strong></td><td style="text-align:left">返回响应码200表示成功，响应内容格式JSON/XML</td></tr><tr><td style="text-align:left">为特定的<strong>appID</strong>/<strong>instanceID</strong>做查询</td><td style="text-align:left">GET /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong></td><td style="text-align:left">返回响应码200表示成功，响应内容格式JSON/XML</td></tr><tr><td style="text-align:left">为特定的<strong>instanceID</strong>做查询</td><td style="text-align:left">GET /eureka/v2/instances/<strong>instanceID</strong></td><td style="text-align:left">返回响应码200表示成功，响应内容格式JSON/XML</td></tr><tr><td style="text-align:left">停止服务实例(Take instance out of service)</td><td style="text-align:left">PUT /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong>/status?value=OUT_OF_SERVICE</td><td style="text-align:left">返回响应码200表示成功，500失败。</td></tr><tr><td style="text-align:left">将实例恢复到服务(移除覆盖)</td><td style="text-align:left">DELETE /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong>/status?value=UP  (value=UP是可选的，它被建议用于fallback状态，由于取消了覆盖)</td><td style="text-align:left">返回响应码200表示成功，500失败。</td></tr><tr><td style="text-align:left">更新元数据</td><td style="text-align:left">PUT /eureka/v2/apps/<strong>appID</strong>/<strong>instanceID</strong>/metadata?key=value</td><td style="text-align:left">返回响应码200表示成功，500失败。</td></tr><tr><td style="text-align:left">查询特定<strong>vip address</strong> 下的所有实例</td><td style="text-align:left">GET /eureka/v2/vips/<strong>vipAddress</strong></td><td style="text-align:left">返回响应码200表示成功，响应内容格式：JSON/XML，返回404表示<strong>vipAddress</strong>不存在</td></tr><tr><td style="text-align:left">查询特定<strong>secure vip address</strong>下所有实例</td><td style="text-align:left">GET /eureka/v2/svips/<strong>svipAddress</strong></td><td style="text-align:left">返回响应码200表示成功，响应内容格式：JSON/XML，返回404表示<strong><strong>svipAddress</strong></strong>不存在</td></tr></tbody></table><p><strong>服务注册</strong></p><p>在进行注册时，你需要提交符合该XSD的XML(或JSON):</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span> <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span> <span class="attr">attributeFormDefault</span>=<span class="string">"unqualified"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"instance"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- hostName in ec2 should be the public dns name, within ec2 public dns name will</span></span><br><span class="line"><span class="comment">                    always resolve to its private IP --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- ec2中的主机名应该是公告的dns名称，在ec2内，公共dns名称将</span></span><br><span class="line"><span class="comment">始终对其私有IP进行解析 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"hostName"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"app"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"ipAddr"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"vipAddress"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"secureVipAddress"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"status"</span> <span class="attr">type</span>=<span class="string">"statusType"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">type</span>=<span class="string">"xsd:positiveInteger"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"securePort"</span> <span class="attr">type</span>=<span class="string">"xsd:positiveInteger"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"homePageUrl"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"statusPageUrl"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"healthCheckUrl"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">ref</span>=<span class="string">"dataCenterInfo"</span> <span class="attr">minOccurs</span>=<span class="string">"1"</span> <span class="attr">maxOccurs</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- optional 可选 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">ref</span>=<span class="string">"leaseInfo"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- optional app specific metadata --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"metadata"</span> <span class="attr">type</span>=<span class="string">"appMetadataType"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"dataCenterInfo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"dcNameType"</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- metadata is only required if name is Amazon --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"metadata"</span> <span class="attr">type</span>=<span class="string">"amazonMetdataType"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"leaseInfo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- (optional) if you want to change the length of lease - default if 90 secs --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 可选， 如果你想更改租约的时间。 - 默认情况下90 秒。(该值会在下面会进行说明。) --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"evictionDurationInSecs"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>  <span class="attr">type</span>=<span class="string">"xsd:positiveInteger"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:simpleType</span> <span class="attr">name</span>=<span class="string">"dcNameType"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Restricting the values to a set of value using 'enumeration' --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用'enumeration'(枚举)将值限制为一组值  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:restriction</span> <span class="attr">base</span> = <span class="string">"xsd:string"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"MyOwn"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"Amazon"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:restriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:simpleType</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:simpleType</span> <span class="attr">name</span>=<span class="string">"statusType"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Restricting the values to a set of value using 'enumeration' --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用'enumeration'(枚举)将值限制为一组值  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:restriction</span> <span class="attr">base</span> = <span class="string">"xsd:string"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"UP"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"DOWN"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"STARTING"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"OUT_OF_SERVICE"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:enumeration</span> <span class="attr">value</span> = <span class="string">"UNKNOWN"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:restriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:simpleType</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:complexType</span> <span class="attr">name</span>=<span class="string">"amazonMetdataType"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- From &lt;a class="jive-link-external-small" href="http://docs.amazonwebservices.com/AWSEC2/latest/DeveloperGuide/index.html?AESDG-chapter-instancedata.html" target="_blank"&gt;http://docs.amazonwebservices.com/AWSEC2/latest/DeveloperGuide/index.html?AESDG-chapter-instancedata.html&lt;/a&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"ami-launch-index"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"local-hostname"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"availability-zone"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"instance-id"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"public-ipv4"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"public-hostname"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"ami-manifest-path"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"local-ipv4"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"hostname"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span>/&gt;</span>      </span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"ami-id"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"instance-type"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:all</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:complexType</span> <span class="attr">name</span>=<span class="string">"appMetadataType"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xsd:sequence</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- this is optional application specific name, value metadata --&gt;</span> </span><br><span class="line">            <span class="comment">&lt;!-- 这是可选的应用专用名，值的元数据。 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">xsd:any</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span> <span class="attr">maxOccurs</span>=<span class="string">"unbounded"</span> <span class="attr">processContents</span>=<span class="string">"skip"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">xsd:sequence</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>evictionDurationInSecs</strong>：<br>默认情况下Eureka Server会每隔60秒检测失效的服务，失效的服务是超过一定时间没有发送心跳进行续约的服务。<br>这里的evictionDurationInSecs用来定义服务租约的超时时间。</p><p>该值定义在<code>org.springframework.cloud.netflix.eureka.EurekaInstanceConfigBean#leaseExpirationDurationInSeconds</code><br>表示eureka server至上一次收到client的心跳之后，等待下一次心跳的超时时间，在这个时间内若没收到下一次心跳，则将移除该instance，<strong>默认为90秒</strong>。</p><ul><li>如果该值太大，则很可能将流量转发过去的时候，该instance已经不存活了。</li><li>如果该值设置太小了，则instance则很可能因为临时的网络抖动而被摘除掉。</li><li>该值至少应该大于leaseRenewalIntervalInSeconds</li></ul><p><strong>服务续约</strong></p><p>示例 : PUT /eureka/v2/apps/MYAPP/i-6589ef6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Response:</span><br><span class="line">Status: </span><br><span class="line">200 (on success)</span><br><span class="line">404 (eureka doesn&apos;t know about you, Register yourself first)</span><br><span class="line">500 (failure)</span><br></pre></td></tr></table></figure></p><p><strong>服务关闭/服务下线</strong></p><p><strong>(If Eureka doesn’t get heartbeats from the service node within the evictionDurationInSecs, then the node will get automatically de-registered )</strong><br>如果Eureka在服务租约超时时间内没有从服务节点获得心跳续约，那么服务节点将自动取消注册。</p><p>示例 : DELETE /eureka/v2/apps/MYAPP/i-6589ef6</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Response:</span><br><span class="line">Status:</span><br><span class="line">200 (on success)</span><br><span class="line">500 (failure)</span><br></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;公司需要调研Eureka在非JAVA语言中的使用，我在Eureka的官方github上找到了一份wiki，是官方提供的Eureka一些REST操作API，其他语言可以使用这些API来实现对Eureka Server的操作从而实现一个非jvm语言的Eureka Client。&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="http://bennie.im/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="Eureka" scheme="http://bennie.im/tags/Eureka/"/>
    
      <category term="微服务" scheme="http://bennie.im/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>多个SSH连接配置之HEXO部署</title>
    <link href="http://bennie.im/2017/08/20/hexo-deploy-with-multiple-ssh-config/"/>
    <id>http://bennie.im/2017/08/20/hexo-deploy-with-multiple-ssh-config/</id>
    <published>2017-08-20T13:18:05.000Z</published>
    <updated>2018-12-29T08:13:04.833Z</updated>
    
    <content type="html"><![CDATA[<p><strong>本文是给自己留个笔记，是建立在本人自己的思路上，所以有些地方不会说的那么详细</strong><br>如果只是来找直接的解决方案，可以参考《<a href="https://knightdevelop.github.io/2017/04/03/%E6%9C%AC%E5%9C%B0%E6%9C%89%E5%A4%9A%E4%B8%AAgithub%E8%B4%A6%E5%8F%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8hexo%E9%83%A8%E7%BD%B2%E5%88%B0%E7%89%B9%E5%AE%9A%E8%B4%A6%E5%8F%B7/" target="_blank" rel="noopener">本地有多个github账号如何使用hexo部署到特定账号</a>》这篇文章。</p><p><code>这里只针对Hexo部署时在多个SSH配置时一些处理，关于多个Github账号的搭配多个SSH配置的问题请自行谷歌了解。</code></p><a id="more"></a><hr><p>多个SSH配置是指的是在用户家目录下.ssh\config文件中(<code>C:\Users\joey\.ssh\config</code>)文件中配置了多个SSH的连接。<br>之前在《<a href="/2017/06/14/how-to-use-ssh-config-file-for-a-ssh-connection/">如何使用SSH配置文件进行SSH连接</a>》已经介绍了多个SSH配置的配置方法。</p><p>但当我们这样子配置之后，会发现在Hexo部署的时候会出现错误。因为Hexo在提交到仓库的时候不知道使用哪个SSH配置。<br>我们要解决的问题让仓库地址跟我们的SSH配置中的Host主机对应上，这样子他就会去找对应的SSH配置了。<br>听起来可能不太明白，其实很简单。</p><p>例如现在我的电脑上有两个Github账号，然后SSH配置文件的连接配置为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Host github_1</span><br><span class="line">    User git</span><br><span class="line">    HostName github.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile C:/Users/joey/.ssh/keys/github_1</span><br><span class="line"></span><br><span class="line">Host github_2</span><br><span class="line">    User git</span><br><span class="line">    HostName github.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile C:/Users/joey/.ssh/keys/github_2</span><br></pre></td></tr></table></figure><p>配置了多个SSH链接，这时候我们如果还是以git作为github.com这个主机的User去连接那么就会失败。</p><blockquote><p>$ ssh -T <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a><br>Permission denied (publickey).</p></blockquote><p>这是因为不能确定具体要去使用哪个配置文件。这时候我们就需要指定具体的Host了，也就是你得通过<code>ssh github_1</code>这样子的方式来连接。</p><blockquote><p>$ ssh -T github_1<br>Hi joey! You’ve successfully authenticated, but GitHub does not provide shell access.</p></blockquote><p>我们的Hexo配置文件_config.yml中Deploy部分的配置正常配置是这么配置的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">- type: git</span><br><span class="line">  repo: </span><br><span class="line">    github: git@github.com:joey/joey.github.io.git</span><br></pre></td></tr></table></figure><p>部署仓库的地址中有<a href="mailto:`git@github.com" target="_blank" rel="noopener">`git@github.com</a><code>这么一段，这就是SSH连接的用户名和主机。这样部署，当Hexo进行ssh通讯的时候就相当于</code>ssh -T <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>`，所以是会导致连接失败的。</p><p>解决方法就是把仓库SSH地址：<a href="mailto:`git@github.com" target="_blank" rel="noopener">`git@github.com</a>:joey/joey.github.io.git<code>中的</code><a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a><code>替换成对应的SSH配置的主机，冒号后面的就是Github的用户名，这个不需要改。例如这里HEXO部署到的Github账号需要使用github_1这个SSH配置来进行SSH连接验证。那么部署的仓库地址就需要写成：</code>repo: github_1:joey/joey.github.io.git`<br>这样子Hexo在部署进行SSH连接的时候就会知道使用哪个SSH配置了。</p><p>这样的做法也适用于部署到多个Git仓库，例如同时部署到了Github和Coding上，那么SSH连接配置和Hexo的配置就是下面这样子：</p><p><strong>SSH连接配置</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Host coding_joey</span><br><span class="line">    User git</span><br><span class="line">    HostName git.coding.net</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile C:/Users/joey/.ssh/keys/coding_joey</span><br><span class="line"></span><br><span class="line">Host github_joey</span><br><span class="line">    User git</span><br><span class="line">    HostName github.com</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile C:/Users/joey/.ssh/keys/github_joey</span><br></pre></td></tr></table></figure><p><strong>Hexo部署配置</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">- type: git</span><br><span class="line">  repo: </span><br><span class="line">    coding: coding_joey:joey/joey.coding.me.git</span><br><span class="line">    github: github_joey:joey/joey.github.io.git</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;本文是给自己留个笔记，是建立在本人自己的思路上，所以有些地方不会说的那么详细&lt;/strong&gt;&lt;br&gt;如果只是来找直接的解决方案，可以参考《&lt;a href=&quot;https://knightdevelop.github.io/2017/04/03/%E6%9C%AC%E5%9C%B0%E6%9C%89%E5%A4%9A%E4%B8%AAgithub%E8%B4%A6%E5%8F%B7%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8hexo%E9%83%A8%E7%BD%B2%E5%88%B0%E7%89%B9%E5%AE%9A%E8%B4%A6%E5%8F%B7/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;本地有多个github账号如何使用hexo部署到特定账号&lt;/a&gt;》这篇文章。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;这里只针对Hexo部署时在多个SSH配置时一些处理，关于多个Github账号的搭配多个SSH配置的问题请自行谷歌了解。&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Hexo" scheme="http://bennie.im/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="http://bennie.im/tags/Hexo/"/>
    
      <category term="SSH" scheme="http://bennie.im/tags/SSH/"/>
    
      <category term="SSHConfig" scheme="http://bennie.im/tags/SSHConfig/"/>
    
  </entry>
  
  <entry>
    <title>Eclipse配置所有工作空间默认文件编码</title>
    <link href="http://bennie.im/2017/08/18/configure-default-file-encoding-for-all-workspace-of-eclipse/"/>
    <id>http://bennie.im/2017/08/18/configure-default-file-encoding-for-all-workspace-of-eclipse/</id>
    <published>2017-08-18T15:57:30.000Z</published>
    <updated>2018-12-29T08:13:04.816Z</updated>
    
    <content type="html"><![CDATA[<p>一般Eclipse创建新的工作空间时都需要手动指定一下编码，也就是File Encoding，这里分享的就是以配置文件的方式来指定所有的工作空间默认的编码。<br>包括新建的工作空间也会生效。</p><p>方法很简单，在Eclipse安装目录，找到<code>eclipse.ini</code>使用文本编辑器打开（建议不要使用记事本）<br>在最后一行加上 <code>-Dfile.encoding=utf-8</code> 即可，建议再加一个回车。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一般Eclipse创建新的工作空间时都需要手动指定一下编码，也就是File Encoding，这里分享的就是以配置文件的方式来指定所有的工作空间默认的编码。&lt;br&gt;包括新建的工作空间也会生效。&lt;/p&gt;
&lt;p&gt;方法很简单，在Eclipse安装目录，找到&lt;code&gt;eclips
      
    
    </summary>
    
      <category term="工具" scheme="http://bennie.im/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Eclipse" scheme="http://bennie.im/tags/Eclipse/"/>
    
      <category term="工具" scheme="http://bennie.im/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Chrome主题背景图URL地址</title>
    <link href="http://bennie.im/2017/08/15/chrome-theme-background-image-url/"/>
    <id>http://bennie.im/2017/08/15/chrome-theme-background-image-url/</id>
    <published>2017-08-15T05:33:47.000Z</published>
    <updated>2018-12-29T08:13:04.815Z</updated>
    
    <content type="html"><![CDATA[<p>主题的背景图比较好看，提取出来做桌面壁纸。<br>在Chrome地址栏输入：<code>chrome://theme/IDR_THEME_NTP_BACKGROUND</code><br>出来背景图右键另存为即可.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;主题的背景图比较好看，提取出来做桌面壁纸。&lt;br&gt;在Chrome地址栏输入：&lt;code&gt;chrome://theme/IDR_THEME_NTP_BACKGROUND&lt;/code&gt;&lt;br&gt;出来背景图右键另存为即可.&lt;/p&gt;

      
    
    </summary>
    
      <category term="Chrome" scheme="http://bennie.im/categories/Chrome/"/>
    
    
      <category term="Chrome" scheme="http://bennie.im/tags/Chrome/"/>
    
  </entry>
  
  <entry>
    <title>网页文本完全水平+垂直居中</title>
    <link href="http://bennie.im/2017/08/01/web-page-horizantal-and-vertical/"/>
    <id>http://bennie.im/2017/08/01/web-page-horizantal-and-vertical/</id>
    <published>2017-08-01T15:20:57.000Z</published>
    <updated>2018-12-29T08:13:04.821Z</updated>
    
    <content type="html"><![CDATA[<h3 id="实现方式1"><a href="#实现方式1" class="headerlink" title="实现方式1"></a>实现方式1</h3><p>定义一个表格，并套上tr及td：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">css</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>加上css样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.table</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="comment">/*vertical-align: middle;*/</span></span><br><span class="line">    <span class="comment">/*The default value is middle can inherit from tbody tag, so it's not necessary.*/</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个css样式的思路就是：</p><ol><li>首先将table变成和浏览器窗口一样的大小。通过设置<code>width: 100%; height: 100%;</code></li><li>其次设置<code>text-align: center;</code>让文本水平居中。</li><li>接着让它的position为absolute表示，让它的子元素相对于它来定位，同时我们设置top和left为0，这时候它现在的位置就是从浏览器左上角00的位置开始了，同时因为absolute的设置可以让它的子元素就是相对于浏览器的最上最左的位置进行定位。</li><li>最后我们其实可以设置一个<code>vertical-align: middle;</code>的样式，但是因为浏览器在处理table标签的时候会默认生成一个tbody标签，这个标签会自动有一个<code>vertical-align: middle;</code>样式，所以在tbody里面的tr和td元素会默认继承这个样式，所以这个样式我们就不用定义了。</li></ol><h3 id="实现方式2"><a href="#实现方式2" class="headerlink" title="实现方式2"></a>实现方式2</h3><p>同实现方式1同样的css样式，html代码改为以下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"table"</span> <span class="attr">style</span>=<span class="string">"display: table"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"display: table-cell; vertical-align: middle;"</span>&gt;</span>这是要居中的文本<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>方式2的实现思路就是将span应用<code>display: table-cell</code>样式后让其拥有和td一样的功能，就相当于将span变成了td元素，然后再通过<code>vertical-align: middle;</code>让其可以居中显示。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;实现方式1&quot;&gt;&lt;a href=&quot;#实现方式1&quot; class=&quot;headerlink&quot; title=&quot;实现方式1&quot;&gt;&lt;/a&gt;实现方式1&lt;/h3&gt;&lt;p&gt;定义一个表格，并套上tr及td：&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;css&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;table&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;tr&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;td&lt;/span&gt;&amp;gt;&lt;/span&gt;文本&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;td&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;tr&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;table&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="前端" scheme="http://bennie.im/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="CSS" scheme="http://bennie.im/tags/CSS/"/>
    
      <category term="table-cell" scheme="http://bennie.im/tags/table-cell/"/>
    
      <category term="postition" scheme="http://bennie.im/tags/postition/"/>
    
  </entry>
  
  <entry>
    <title>如何使用SSH配置文件进行SSH连接</title>
    <link href="http://bennie.im/2017/06/14/how-to-use-ssh-config-file-for-a-ssh-connection/"/>
    <id>http://bennie.im/2017/06/14/how-to-use-ssh-config-file-for-a-ssh-connection/</id>
    <published>2017-06-13T17:30:16.000Z</published>
    <updated>2018-12-29T08:13:04.825Z</updated>
    
    <content type="html"><![CDATA[<p>SSH配置文件可以方便我们进行一个SSH连接。而不用每次连接的时候都输入账号和密码。</p><h2 id="不使用配置文件进行连接-使用命令行方式"><a href="#不使用配置文件进行连接-使用命令行方式" class="headerlink" title="不使用配置文件进行连接(使用命令行方式)"></a>不使用配置文件进行连接(使用命令行方式)</h2><p>那么我们在不使用配置文件的时候(使用命令行的方式)是如何建立连接的呢？</p><h3 id="用密码登录"><a href="#用密码登录" class="headerlink" title="用密码登录"></a>用密码登录</h3><p>输入命令：<code>ssh root@66.111.222.23 -p 27275</code></p><h3 id="用密钥登录"><a href="#用密钥登录" class="headerlink" title="用密钥登录"></a>用密钥登录</h3><p>输入命令：<code>ssh root@66.111.222.23 -p 27275 -i ~/VPS_SSH_KEY/66.111.222.23.pri</code><br>通过-p参数指定端口(默认为22)，-i参数手动指定私钥的路径。</p><a id="more"></a><blockquote></blockquote><p>~代表用户家目录，如果你电脑用户名为flix<br>对Windows系统来说，用户家目录的路径就是<code>C:\User\flix\</code><br>对Linux系统来说就是<code>/home/flix/</code></p><h2 id="使用配置文件方式登录-基于密钥"><a href="#使用配置文件方式登录-基于密钥" class="headerlink" title="使用配置文件方式登录(基于密钥)"></a>使用配置文件方式登录(基于密钥)</h2><p>上面通过命令行的方式登录，麻烦的地方在于每次都要输入password或者私钥的passphrase，所以这里说一下SSH的配置文件方式来登录。</p><h3 id="建立目录并创建文件"><a href="#建立目录并创建文件" class="headerlink" title="建立目录并创建文件"></a>建立目录并创建文件</h3><p>首先在<strong>用户家目录里</strong>建立.ssh文件夹(如果没有创建该文件夹)，然后在.ssh文件夹里建立一个<strong>config</strong>文件。</p><ol><li>Windows系统在新建.ssh文件夹时需要通过cmd命令来新建，在cmd窗口输入<code>mkdir .ssh</code>，然后再在.ssh文件夹中新建config文件。</li><li><p>Linux系统按照顺序输入下面3个命令：<br>最后chmod为什么要输入，最下面的注意事项会说。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.ssh</span><br><span class="line">touch ~/.ssh/config</span><br><span class="line">chmod 600 ~/.ssh/config</span><br></pre></td></tr></table></figure></li></ol><h3 id="编辑文件内容"><a href="#编辑文件内容" class="headerlink" title="编辑文件内容"></a>编辑文件内容</h3><p>编辑config文件的内容，输入相关的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host 66.vps</span><br><span class="line">    HostName 66.111.222.23</span><br><span class="line">    Port 27275</span><br><span class="line">    User root</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/VPS_SSH_KEY/66.111.222.23.pri</span><br></pre></td></tr></table></figure></p><p>Windows系统用记事本编辑config文件。<br>Linux系统输入命令<code>vi ~/.ssh/config</code>来进行编辑。<br>上面的内容做一下说明，<strong>具体的配置你按照自己的配置进行替换</strong>，config文件中是用Host配置项来进行多个配置的分割。并用缩进符来进行一些子项配置。</p><ul><li>Host后面的文本内容可以随意命名，起一个标识作用，用于区分多个Host</li><li>HostName用于指定主机地址，可以是域名或者ip地址</li><li>Port用于指定主机端口，如果不写这一项默认端口为22</li><li>User指定主机的用户名，就是命令<code>ssh root@66.111.222.23</code>@前面的用户名</li><li>PreferredAuthentications 指定优先身份认证方式，由于我们是通过公私钥来与服务器进行验证交互，所以这里写publickey就行(默认是按照gssapi-with-mic,hostbased,publickey,keyboard-interactive,password这样的顺序来进行身份验证)</li><li>IdentityFile就是指定私钥的路径</li></ul><h3 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h3><p>经过这样的配置之后我们就可以使用<code>ssh 66.vps</code>如此简单的命令来连接了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flix@flix-PC:~$ ssh 66.vps</span><br><span class="line">Enter passphrase for key &apos;~/VPS_SSH_KEY/66.111.222.23.pri&apos;: </span><br><span class="line">Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-79-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">0 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** System restart required ***</span><br><span class="line">root@ubuntu:~#</span><br></pre></td></tr></table></figure><p>这样子是不是简单多了。</p><h2 id="配置多个Host"><a href="#配置多个Host" class="headerlink" title="配置多个Host"></a>配置多个Host</h2><p>我们也可以利用配置文件的方式来配置多个不同提供了SSH连接的主机。<br>下面是2个Github配置以及一个Coding.net的配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Host github1 </span><br><span class="line">    HostName github.com</span><br><span class="line">    User git</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/Git_SSH_KEY/github1.pri</span><br><span class="line"></span><br><span class="line">Host github2 </span><br><span class="line">    HostName github.com</span><br><span class="line">    User git</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/Git_SSH_KEY/github2.pri</span><br><span class="line">    </span><br><span class="line">Host coding</span><br><span class="line">    HostName git.coding.net</span><br><span class="line">    User git</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    IdentityFile ~/Git_SSH_KEY/coding.pri</span><br></pre></td></tr></table></figure><p>输入<code>ssh -T github1</code>测试连接是否成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flix@flix-PC:~$ ssh -T github1</span><br><span class="line">Hi flix! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure></p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>在Linux中，你的私钥文件，以及.ssh文件夹下的config文件，权限如果过于开放，那么在进行连接的时候会提示你<strong>Bad owner or permissions on ~/.ssh/config</strong>，目的是提醒你这些重要的文件你不应该对其他人开放较高的权限。解决这一问题的办法很简单。<br>只需要降低文件权限即可。<br>输入<code>chmod 600 ~/.ssh/config</code>只给予当前读写权限。<br>私钥文件的权限也要这样设置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flix@flix-PC:~$ ls -l .ssh/config ~/Git_SSH_KEY/github.pri</span><br><span class="line">-rw------- 1 flix flix  462 6月  14 00:22 .ssh/config</span><br><span class="line">-rw------- 1 flix flix 1794 6月  11 14:50 ~/Git_SSH_KEY/github.pri</span><br></pre></td></tr></table></figure><h2 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h2><p>也许有的人会好奇config文件里都可以配置哪些东西，这里就不描述那么多了，你可以看一下命令手册：<a href="http://man.openbsd.org/ssh_config" target="_blank" rel="noopener">《ssh_cofig》</a>，Linux系统直接<code>man ssh_config</code>。</p><h2 id="其他SSH相关"><a href="#其他SSH相关" class="headerlink" title="其他SSH相关"></a>其他SSH相关</h2><p>Git SSH Key 生成步骤：<a href="http://blog.csdn.net/hustpzb/article/details/8230454" target="_blank" rel="noopener">http://blog.csdn.net/hustpzb/article/details/8230454</a><br>SSH密钥登录让Linux VPS/服务器更安全：<a href="https://www.vpser.net/security/linux-ssh-authorized-keys-login.html" target="_blank" rel="noopener">https://www.vpser.net/security/linux-ssh-authorized-keys-login.html</a><br>使用 SSH config 文件：<a href="http://daemon369.github.io/ssh/2015/03/21/using-ssh-config-file" target="_blank" rel="noopener">http://daemon369.github.io/ssh/2015/03/21/using-ssh-config-file</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SSH配置文件可以方便我们进行一个SSH连接。而不用每次连接的时候都输入账号和密码。&lt;/p&gt;
&lt;h2 id=&quot;不使用配置文件进行连接-使用命令行方式&quot;&gt;&lt;a href=&quot;#不使用配置文件进行连接-使用命令行方式&quot; class=&quot;headerlink&quot; title=&quot;不使用配置文件进行连接(使用命令行方式)&quot;&gt;&lt;/a&gt;不使用配置文件进行连接(使用命令行方式)&lt;/h2&gt;&lt;p&gt;那么我们在不使用配置文件的时候(使用命令行的方式)是如何建立连接的呢？&lt;/p&gt;
&lt;h3 id=&quot;用密码登录&quot;&gt;&lt;a href=&quot;#用密码登录&quot; class=&quot;headerlink&quot; title=&quot;用密码登录&quot;&gt;&lt;/a&gt;用密码登录&lt;/h3&gt;&lt;p&gt;输入命令：&lt;code&gt;ssh root@66.111.222.23 -p 27275&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;用密钥登录&quot;&gt;&lt;a href=&quot;#用密钥登录&quot; class=&quot;headerlink&quot; title=&quot;用密钥登录&quot;&gt;&lt;/a&gt;用密钥登录&lt;/h3&gt;&lt;p&gt;输入命令：&lt;code&gt;ssh root@66.111.222.23 -p 27275 -i ~/VPS_SSH_KEY/66.111.222.23.pri&lt;/code&gt;&lt;br&gt;通过-p参数指定端口(默认为22)，-i参数手动指定私钥的路径。&lt;/p&gt;
    
    </summary>
    
      <category term="SSH" scheme="http://bennie.im/categories/SSH/"/>
    
    
      <category term="SSH" scheme="http://bennie.im/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>谷歌验证码jar包Kaptcha的使用和运行过程</title>
    <link href="http://bennie.im/2017/04/17/google-s-kaptcha-jar-usage-and-running-process/"/>
    <id>http://bennie.im/2017/04/17/google-s-kaptcha-jar-usage-and-running-process/</id>
    <published>2017-04-17T15:25:36.000Z</published>
    <updated>2018-12-29T08:13:04.829Z</updated>
    
    <content type="html"><![CDATA[<p>首先说一下使用方法, 然后下面说一下运行过程!</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>首先在web.xml中加入KaptchServlet</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>然后页面写一个form表单和一个验证码代码.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html;charset=UTF-8"</span></span><br><span class="line">         pageEncoding=<span class="string">"UTF-8"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;验证码&lt;/title&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&lt;img src="/kaptcha.jpg" id="kaptchaImage"&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td align=<span class="string">"top"</span>&gt;</span><br><span class="line">            &lt;form method=<span class="string">"POST"</span>&gt;</span><br><span class="line">                &lt;br&gt;验证码:&lt;input type=<span class="string">"text"</span> name=<span class="string">"kaptchafield"</span>&gt;&lt;br/&gt;</span><br><span class="line">                &lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span>&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// 从session中获取验证码的值!</span></span><br><span class="line">    String c = (String) session.getAttribute(</span><br><span class="line">            com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">    <span class="comment">// 获取输入的验证码值!</span></span><br><span class="line">    String parm = (String) request.getParameter(<span class="string">"kaptchafield"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( c != <span class="keyword">null</span> &amp;&amp; parm != <span class="keyword">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( c.equals(parm) ) &#123;</span><br><span class="line">            out.println(<span class="string">"&lt;b&gt;验证码正确&lt;/b&gt;"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            out.println(<span class="string">"&lt;b&gt;验证码错误&lt;/b&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 引用Jquery之后再写这个代码就可以通过点击图片换验证码了. --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/Javascript"</span>&gt;</span><br><span class="line">    $(function() &#123;</span><br><span class="line">        $(<span class="string">'#kaptchaImage'</span>).click(function () &#123; </span><br><span class="line">            $(<span class="keyword">this</span>).attr(<span class="string">'src'</span>, <span class="string">'/kaptcha.jpg?'</span> + Math.floor(Math.random()*<span class="number">100</span>) ); </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>使用就是这么简单. 下面说一下运行流程.</p><h3 id="运行过程"><a href="#运行过程" class="headerlink" title="运行过程"></a>运行过程</h3><p><strong>建议使用开启debug后跟着下面的描述看一下运行流程.</strong></p><p>这个框架是帮我们生成验证码用的, 验证码就是一个图片.<br>那么在生成的时候肯定要请求一个地址, 通过这个地址返回一个图片.<br>那么我们需要找到这个jar包用于生成验证码的servlet. </p><p>在 <a href="https://code.google.com/archive/p/kaptcha/wikis/HowToUse.wiki" target="_blank" rel="noopener">https://code.google.com/archive/p/kaptcha/wikis/HowToUse.wiki</a><br>查看查看谷歌的wiki()之后, 发现需要配置<code>com.google.code.kaptcha.servlet.KaptchaServlet</code>这个servlet. 配置格式为:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>好了, 这样在页面上再写一个img标签, 让src指向这个url-pattern里面的路径就可以拿到图片验证码了!<br><code>&lt;img src=&quot;/kaptcha.jpg&quot;/&gt;</code><br>由于url-pattern是自定义的, 所以可以换成别的也可以.</p><p>这样基本的就搞定了, 打开<code>com.google.code.kaptcha.servlet.KaptchaServlet</code>这个servlet看一下里面的源码, 发现就两个方法, 一个init初始化, 一个doget处理请求的方法.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig conf)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.init(conf);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Switch off disk based caching.</span></span><br><span class="line">ImageIO.setUseCache(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">Enumeration&lt;?&gt; initParams = conf.getInitParameterNames();</span><br><span class="line"><span class="keyword">while</span> ( initParams.hasMoreElements() ) &#123;</span><br><span class="line">String key = (String) initParams.nextElement();</span><br><span class="line">String value = conf.getInitParameter(key);</span><br><span class="line"><span class="keyword">this</span>.props.put(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Config config = <span class="keyword">new</span> Config(<span class="keyword">this</span>.props);</span><br><span class="line"><span class="keyword">this</span>.kaptchaProducer = config.getProducerImpl();</span><br><span class="line"><span class="keyword">this</span>.sessionKeyValue = config.getSessionKey();</span><br><span class="line"><span class="keyword">this</span>.sessionKeyDateValue = config.getSessionDate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>init方法就是通过servletconfig对象获取配置信息.<br>获取了所有的初始化参数, 然后放到一个Properties对象中.<br>然后把Properties对象传递过去, 创建Config对象, </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Config</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.properties = properties;</span><br><span class="line"><span class="keyword">this</span>.helper = <span class="keyword">new</span> ConfigHelper();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到没做什么额外的事情.<br>接下来config.getProducerImpl(), 获取一个验证码生成器对象.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Producer <span class="title">getProducerImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String paramName = Constants.KAPTCHA_PRODUCER_IMPL;</span><br><span class="line">String paramValue = <span class="keyword">this</span>.properties.getProperty(paramName);</span><br><span class="line"></span><br><span class="line">Producer producer = (Producer) <span class="keyword">this</span>.helper.getClassInstance(paramName, paramValue, <span class="keyword">new</span> DefaultKaptcha(), <span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">return</span> producer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前两句就是获取配置文件里有没有通过kaptcha.producer.impl配置自定义的验证码生成器对象.<br>this.helper.getClassInstance()就是通过ConfigHelper对象获取验证码生成器对象, 这里强转是干了一个向上转型的事!<br>getClassInstance()这个方法就是判断有没有在servlet的初始化参数里配置自定义的验证码生成器, 没有的话就返回传递过去的new DefaultKaptcha()对象.</p><hr><p>接下来到init方法里的<code>this.sessionKeyValue = config.getSessionKey();</code>这一段代码.<br>这段代码是干嘛的呢, 作用就是看我们有没有在servlet里通过<code>kaptcha.session.key</code>配置用于给谷歌设置验证码值的session key初始化参数.<br>如果没有就返回<code>KAPTCHA_SESSION_KEY</code>这个字符串作为session的key.<br>可能大家不太理解为什么我这样说, 下面我会解释.<br>然后执行<code>this.sessionKeyDateValue = config.getSessionDate();</code>, 这个代码和上一段代码类似, 就是去初始化参数里找<code>kaptcha.session.date</code>的值, 用于session的key, 如果初始化参数里没有那么让<code>KAPTCHA_SESSION_DATE</code>这个字符串作为session的key.<br>这两个代码的作用一会我会解释.</p><hr><p>执行完<code>this.sessionKeyDateValue = config.getSessionDate();</code>这段代码后, 整个<code>com.google.code.kaptcha.servlet.KaptchaServlet</code>的init方法完毕了, 也就是servlet的初始化完了.</p><p>不过这时候还没开始下发验证码, 那么上面时候下发呢.<br>当然是KaptchaServlet这个servlet的dopost或者doget方法被调用的时候执行.</p><p>但KaptchaServlet只有一个doget方法, 不提供doPost方法的原因就在于img标签src属性发起的是一个get请求而不是post请求.<br>所以聪明的google自然也没必要写一个多余的dopost了.<br>那么当浏览器加载img标签, 检查到src属性, 发起了一个可爱的get请求之后, KaptchaServlet开始执行doGet方法.<br>这个就是doGet的处理代码, 我们来研究一下.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">// Set to expire far in the past.</span></span><br><span class="line">resp.setDateHeader(<span class="string">"Expires"</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// Set standard HTTP/1.1 no-cache headers.</span></span><br><span class="line">resp.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-store, no-cache, must-revalidate"</span>);</span><br><span class="line"><span class="comment">// Set IE extended HTTP/1.1 no-cache headers (use addHeader).</span></span><br><span class="line">resp.addHeader(<span class="string">"Cache-Control"</span>, <span class="string">"post-check=0, pre-check=0"</span>);</span><br><span class="line"><span class="comment">// Set standard HTTP/1.0 no-cache header.</span></span><br><span class="line">resp.setHeader(<span class="string">"Pragma"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// return a jpeg</span></span><br><span class="line">resp.setContentType(<span class="string">"image/jpeg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the text for the image</span></span><br><span class="line">String capText = <span class="keyword">this</span>.kaptchaProducer.createText();</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the text in the session</span></span><br><span class="line">req.getSession().setAttribute(<span class="keyword">this</span>.sessionKeyValue, capText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the date in the session so that it can be compared</span></span><br><span class="line"><span class="comment">// against to make sure someone hasn't taken too long to enter</span></span><br><span class="line"><span class="comment">// their kaptcha</span></span><br><span class="line">req.getSession().setAttribute(<span class="keyword">this</span>.sessionKeyDateValue, <span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the image with the text</span></span><br><span class="line">BufferedImage bi = <span class="keyword">this</span>.kaptchaProducer.createImage(capText);</span><br><span class="line"></span><br><span class="line">ServletOutputStream out = resp.getOutputStream();</span><br><span class="line"></span><br><span class="line"><span class="comment">// write the data out</span></span><br><span class="line">ImageIO.write(bi, <span class="string">"jpg"</span>, out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前面那几行设置响应信息的代码就不看了.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create the text for the image</span></span><br><span class="line">String capText = <span class="keyword">this</span>.kaptchaProducer.createText();</span><br></pre></td></tr></table></figure><p>这个代码, 看注释就知道是创建用于验证码的文本. 就是验证码的文本内容.</p><p>this.kaptchaProducer还记得这个值是啥吗?<br>看名字是验证码生成器的意思, 这个值早在init方法加载的时就被赋值了.<br>就是在<code>com.google.code.kaptcha.util.Config#getProducerImpl</code>这个方法里赋值的.<br>上面我已经说过这个方法了, 就是返回了谷歌自己的默认验证码生成器对象: <strong>DefaultKaptcha</strong><br>然后<code>this.kaptchaProducer.createText()</code>就是调用DefaultKaptcha里面的createText()方法,<br>就是创建了一个文本. 我这里简单的讲解下文本的创建过程.感兴趣的朋友可以自己看底层代码.<br>底层代码在: <code>com.google.code.kaptcha.impl.DefaultKaptcha#createText</code><br>主要实现过程就是先检查<code>KaptchaServlet</code>初始化参数里有没有配置<code>kaptcha.textproducer.impl</code>的值, 这个是配置自定义的文本生成器.</p><p>如果没有配置就创建谷歌自己的 DefaultTextCreator(默认文本生成器)对象.<br>调用createText()这个方法, 这个方法就是获取<code>KaptchaServlet</code>初始化参数为<code>kaptcha.textproducer.char.length</code>配置的一个字符串.<br>这个参数就是配置生成的验证码的字母数, 也就是字符数量. 如果没有配置, 那么底层传递的默认值是5个!<br>然后获取<code>KaptchaServlet</code>初始化参数中的<code>kaptcha.textproducer.char.string</code>配置的值, 这个配置就是生成验证码提供的字符串.<br>底层就是通过将这个字符串转成char数组, 然后根据长度随机取出5个字符作为验证码. 如果不提供这个值, 底层自己提供了一个默认的字符串.<br>这样就返回了验证码的文本.</p><p>这里提醒一下, 上面说到会获取初始化参数有没有配置<code>kaptcha.textproducer.impl</code>, 那么就是说我们可以通过实现TextProducer这个接口自己实现一个验证码文本生成器来生成自定义的文本.<br>然后<code>DefaultTextCreator</code>对象是<code>TextProducer</code>的实现类,  还有<code>ChineseTextProducer</code>和<code>FiveLetterFirstNameTextCreator</code> 两个实现类, 英文好的同学这里就知道这2个实现类是干啥子的了.<br>ChineseTextProducer 中文文本生成器, FiveLetterFirstNameTextCreator 以5个字母组成的人的名字生成器.<br>这两个类就比较简单了, 直接是提供一个string数据, 内置了一些字符串, 然后随机取其中一个返回.</p><hr><p>上面创建了验证码的文本, 到了下面的2个代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store the text in the session</span></span><br><span class="line">req.getSession().setAttribute(<span class="keyword">this</span>.sessionKeyValue, capText);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the date in the session so that it can be compared</span></span><br><span class="line"><span class="comment">// against to make sure someone hasn't taken too long to enter</span></span><br><span class="line"><span class="comment">// their kaptcha</span></span><br><span class="line">req.getSession().setAttribute(<span class="keyword">this</span>.sessionKeyDateValue, <span class="keyword">new</span> Date());</span><br></pre></td></tr></table></figure><p>上面给大家埋了一个关子, 就是在KaptchaServlet初始化的时候获取了2个sessionKey.<br>这里来通过sessionKey往session里设置了刚才创建的验证码文本, 以及一个时间对象.<br>具体的作用, 这2个代码的注释说了. 存储验证码文本到session中, 以及存储当前的时间到session里,<br>然后存储当前时间可以依照这个来对比确保用户是不是过了很久才输入验证码.<br>这个有啥用呢, 就是说谷歌给我们提供了一个验证码超时的时间, 然后我们从session中获取这个key, 然后根据这个时间写一个判断是不是要让验证码失效. 因为我们有时候会需要让验证码失效的功能, 如果在一定的时间内没有输入.<br>至于第一个那个设置验证码文本到session中就是让我们更好的获取验证码的值来判断用户输入的是不是对的验证码.<br>比如我们在jsp中就可以写一个判断验证码对不对, 然后再决定要不要提交表单!</p><p>剩下的3行代码没什么好说的了, 底层的东西了, 设计到什么画图啊2d啊的东西, 本人还不懂, 就暂时不介绍了, 感兴趣的朋友自己研究吧.<br>主要就是把文本弄到一个图片上, 然后发送给浏览器.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create the image with the text</span></span><br><span class="line">BufferedImage bi = <span class="keyword">this</span>.kaptchaProducer.createImage(capText);</span><br><span class="line"></span><br><span class="line">ServletOutputStream out = resp.getOutputStream();</span><br><span class="line"></span><br><span class="line"><span class="comment">// write the data out</span></span><br><span class="line">ImageIO.write(bi, <span class="string">"jpg"</span>, out);</span><br></pre></td></tr></table></figure><p>上面说了一堆, 其实还有很多地方没有说, 但这些已经差不多就是主要的流程了.<br>其他的特别细致的地方这里就不再说明.</p><p>简单说一下, 首先我们配置KaptchaServlet, 然后写一个url-pattern.<br>然后读取我们配置在Servlet中的初始化参数来生成验证码.<br>在生成验证码的时候会把验证码放到session中, session的key就是我们通过kaptcha.session.key配置的值.<br>如果没有配置那么session的key就是KAPTCHA_SESSION_KEY. 然后我们可以通过key来获取验证码的值, 来进行判断验证码是否正确!</p><p>补充: 上面说的很多可以在KaptchaServlet初始化参数中配置的东西, 可以在<code>com.google.code.kaptcha.Constants</code>这个类中看到.<br>定义了很多常量, 用于配置生成验证码的参数!</p><p>下面是整理的一些参数的意思: </p><table><thead><tr><th style="text-align:center">配置项</th><th style="text-align:center">默认值</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">kaptcha.border</td><td style="text-align:center">yes</td><td style="text-align:center">验证码图片的边框，可以设置yes或者no</td></tr><tr><td style="text-align:center">kaptcha.border.color</td><td style="text-align:center">black</td><td style="text-align:center">边框的颜色reg值。合法值 rgb，black，blue，white</td></tr><tr><td style="text-align:center">kaptcha.border.thickness</td><td style="text-align:center">1</td><td style="text-align:center">边框的厚度</td></tr><tr><td style="text-align:center">kaptcha.image.width</td><td style="text-align:center">200</td><td style="text-align:center">图片的宽度</td></tr><tr><td style="text-align:center">kaptcha.image.height</td><td style="text-align:center">50</td><td style="text-align:center">图片的高度</td></tr><tr><td style="text-align:center">kaptcha.producer.impl</td><td style="text-align:center">com.google.code.kaptcha.impl.DefaultKaptcha</td><td style="text-align:center">验证码生成器实现类, 可以实现Producer接口自定义一个!</td></tr><tr><td style="text-align:center">kaptcha.textproducer.impl</td><td style="text-align:center">com.google.code.kaptcha.text.impl.DefaultTextCreator</td><td style="text-align:center">生成验证码文字的实现类, 具体我上面描述过了.</td></tr><tr><td style="text-align:center">kaptcha.textproducer.char.string</td><td style="text-align:center">abcde2345678gfynmnpwx</td><td style="text-align:center">验证码中使用的字符</td></tr><tr><td style="text-align:center">kaptcha.textproducer.char.length</td><td style="text-align:center">5</td><td style="text-align:center">验证码中字符的数量</td></tr><tr><td style="text-align:center">kaptcha.textproducer.font.names</td><td style="text-align:center">Arial, Courier</td><td style="text-align:center">验证码的字体</td></tr><tr><td style="text-align:center">kaptcha.textproducer.font.size</td><td style="text-align:center">40</td><td style="text-align:center">字体的大小</td></tr><tr><td style="text-align:center">kaptcha.textproducer.font.color</td><td style="text-align:center">black</td><td style="text-align:center">字体颜色 rgb值，颜色单词</td></tr><tr><td style="text-align:center">kaptcha.textproducer.char.space</td><td style="text-align:center">2</td><td style="text-align:center">两个字符之间的间距</td></tr><tr><td style="text-align:center">kaptcha.noise.impl</td><td style="text-align:center">com.google.code.kaptcha.impl.DefaultNoise</td><td style="text-align:center">干扰线生成类</td></tr><tr><td style="text-align:center">kaptcha.noise.color</td><td style="text-align:center">black</td><td style="text-align:center">干扰线颜色</td></tr><tr><td style="text-align:center">kaptcha.obscurificator.impl</td><td style="text-align:center">com.google.code.kaptcha.impl.WaterRipple(水波效果)</td><td style="text-align:center">模糊迷惑器的实现类.用于干扰验证码的识别!</td></tr><tr><td style="text-align:center">kaptcha.background.impl</td><td style="text-align:center">com.google.code.kaptcha.impl.DefaultBackground</td><td style="text-align:center">背景颜色设置类</td></tr><tr><td style="text-align:center">kaptcha.background.clear.from</td><td style="text-align:center">light grey</td><td style="text-align:center">渐变颜色 左到右</td></tr><tr><td style="text-align:center">kaptcha.background.clear.to</td><td style="text-align:center">white</td><td style="text-align:center">渐变颜色 右到左</td></tr><tr><td style="text-align:center">kaptcha.word.impl</td><td style="text-align:center">com.google.code.kaptcha.text.impl.DefaultWordRenderer</td><td style="text-align:center">文本渲染器</td></tr><tr><td style="text-align:center">kaptcha.session.key</td><td style="text-align:center">KAPTCHA_SESSION_KEY</td><td style="text-align:center">配置获取验证码的sessionKey</td></tr><tr><td style="text-align:center">kaptcha.session.date</td><td style="text-align:center">KAPTCHA_SESSION_DATE</td><td style="text-align:center">配置获取验证码生成的时间的session key.</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;首先说一下使用方法, 然后下面说一下运行过程!&lt;/p&gt;
&lt;h3 id=&quot;使用方法&quot;&gt;&lt;a href=&quot;#使用方法&quot; class=&quot;headerlink&quot; title=&quot;使用方法&quot;&gt;&lt;/a&gt;使用方法&lt;/h3&gt;&lt;p&gt;首先在web.xml中加入KaptchServlet&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;Kaptcha&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-class&lt;/span&gt;&amp;gt;&lt;/span&gt;com.google.code.kaptcha.servlet.KaptchaServlet&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-class&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-mapping&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;Kaptcha&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-name&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;url-pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;/kaptcha.jpg&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;url-pattern&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;servlet-mapping&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
      <category term="验证码Jar包" scheme="http://bennie.im/tags/%E9%AA%8C%E8%AF%81%E7%A0%81Jar%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>遍历List集合时出现的3种异常</title>
    <link href="http://bennie.im/2017/04/10/three-exception-will-be-happenning-when-interaotr-a-list/"/>
    <id>http://bennie.im/2017/04/10/three-exception-will-be-happenning-when-interaotr-a-list/</id>
    <published>2017-04-10T13:29:48.000Z</published>
    <updated>2018-12-29T08:13:04.798Z</updated>
    
    <content type="html"><![CDATA[<p>参考:<br><a href="http://blog.csdn.net/izard999/article/details/6708738" target="_blank" rel="noopener">http://blog.csdn.net/izard999/article/details/6708738</a><br><a href="http://bbs.itheima.com/thread-41997-1-1.html" target="_blank" rel="noopener">http://bbs.itheima.com/thread-41997-1-1.html</a></p><h2 id="异常1"><a href="#异常1" class="headerlink" title="异常1"></a>异常1</h2><p>异常: <strong>java.util.ConcurrentModificationException</strong> (并发修改异常)</p><p>link: <a href="http://bbs.itheima.com/thread-41997-1-1.html" target="_blank" rel="noopener">http://bbs.itheima.com/thread-41997-1-1.html</a> 此贴描述了第一种异常.<br>当我们在使用foreach这个增强型for循环遍历List时, 除了<code>System.out.println();</code>打印可以之外, 其他add, remove等操作会发生异常(<code>执行set方法不会抛出异常</code>).</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AAA</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 要求： 查找集合中有没有zhangsan这个字符串。如果有，则再添加一个lisi进去。</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建集合对象</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        list.add(<span class="string">"zhaoliu"</span>);</span><br><span class="line">        list.add(<span class="string">"zhangsan"</span>);</span><br><span class="line">        list.add(<span class="string">"wangwu"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通for循环</span></span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">int</span> x = <span class="number">0</span>; x &lt; list.size(); x++ ) &#123;</span><br><span class="line">            String s = list.get(x);</span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">"zhangsan"</span>.equals(s) ) &#123;</span><br><span class="line">                list.add(<span class="string">"lisi"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"list:"</span> + list);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"******************************************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//增强for循环</span></span><br><span class="line">        <span class="keyword">for</span> ( String s : list ) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">"zhangsan"</span>.equals(s) ) &#123;</span><br><span class="line">                list.add(<span class="string">"lisi"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"list:"</span> + list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上代码在增强for循环遍历时执行add方法会抛出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\Java\jdk1.8.0_112\bin\java </span><br><span class="line">java.util.ConcurrentModificationException</span><br><span class="line">    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:901)</span><br><span class="line">    at java.util.ArrayList$Itr.next(ArrayList.java:851)</span><br></pre></td></tr></table></figure><p>ConcurrentModificationException翻译为: 并发修改异常.<br>这就代表同时发生了一个操作.<br>那么借由上面链接中的帖子来解释说在使用foreach遍历的时候, 其实是通过一个迭代器进行迭代, 而在迭代的过程中不允许对List集合进行增删之类的操作.<br>下面是发生其异常的原因, 也可以参考: <a href="http://bbs.itheima.com/forum.php?mod=viewthread&amp;tid=41997&amp;page=1&amp;authorid=75804" target="_blank" rel="noopener">http://bbs.itheima.com/forum.php?mod=viewthread&amp;tid=41997&amp;page=1&amp;authorid=75804</a> 这里的解释.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">at java.util.AbstractList$Itr.checkForComodification(Unknown Source)</span><br><span class="line">at java.util.AbstractList$Itr.next(Unknown Source)</span><br></pre></td></tr></table></figure><p><strong>java.util.AbstractList$Itr 中$符号后面的Itr表示Itr是AbstractList中的一个内部类.</strong></p><p>在AbstractList$Itr这个类中实现了Iterator接口，当使用增强的for循环时，<br>应该是使用迭代器进行迭代了，如果你在这期间使用了<strong>add或remove</strong>方法的话，在ArrayList类中执行了这样的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacity(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>add方法中调用了ensureCapacity方法.</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; oldCapacity) &#123;</span><br><span class="line">        Object oldData[] = elementData;</span><br><span class="line">        <span class="keyword">int</span> newCapacity = (oldCapacity * <span class="number">3</span>)/<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (newCapacity &lt; minCapacity)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>add和remove方法都引起了AbstractList$Itr中的modCount属性增加值，然后当下一次遍历List, 迭代器调用next方法时调用了checkForComodification()方法.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        E next = get(cursor);</span><br><span class="line">        lastRet = cursor++;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">        checkForComodification();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但<code>checkForComodification()</code>方法进行了modeCount和expectedModCount(翻译为: 预期修改次数)判断, 发现不一致, 所以抛出了异常.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="异常2"><a href="#异常2" class="headerlink" title="异常2"></a>异常2</h2><p>异常: <strong>java.lang.IllegalStateException</strong> (非法状态异常)<br>情景如下:</p><p>我们知道<code>Arrays.asList(T ... t);</code>可以将一个数组变成一个List.<br>代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemove</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"fd"</span>, <span class="string">"fds"</span>, <span class="string">"2341f"</span>);</span><br><span class="line"></span><br><span class="line">    Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> ( it.hasNext() ) &#123;</span><br><span class="line">        it.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在执行到<code>it.remove();</code>时会触发异常.<br>首先<code>Arrays.asList(&quot;fd&quot;, &quot;fds&quot;, &quot;2341f&quot;);</code>会返回一个List, 那么这个List是什么类型呢? 通过查看源代码可以发现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">asList</span><span class="params">(T... a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看起来没什么问题, 但是这里有必要说明一下, 此ArrayList非<code>java.util.ArrayList</code>这个ArrayList. what??? 难道还有两个ArrayList, 是的.. 那么我们看一下这个ArrayList到底是哪里的, Ctrl + T按下发现这里的ArrayList原来是Arrays这个类中维护的一个内部类, <code>当然他也是继承自AbstractList</code><br>wtfuck…jdk大佬真会玩. 但此ArrayList中并没有提供Iterator()方法, 所以调用Iterator方法还是执行的父类AbstractList中的Iterator方法, </p><p>在java.util.AbstractList$Itr中我们可以看到next和remove方法.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Index of element returned by most recent call to next or</span></span><br><span class="line"><span class="comment"> * previous.  Reset to -1 if this element is deleted by a call</span></span><br><span class="line"><span class="comment"> * to remove.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> lastRet = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        AbstractList.<span class="keyword">this</span>.remove(lastRet);</span><br><span class="line">        <span class="keyword">if</span> (lastRet &lt; cursor)</span><br><span class="line">            cursor--;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于这里的lastRet 初始值为-1, 所以执行remove方法时触发异常.</p><h2 id="异常3"><a href="#异常3" class="headerlink" title="异常3"></a>异常3</h2><p>异常: <strong>java.lang.UnsupportedOperationException</strong> (不支持的操作异常)<br>代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemove</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"fd"</span>, <span class="string">"fds"</span>, <span class="string">"2341f"</span>);</span><br><span class="line"></span><br><span class="line">    Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line">    <span class="keyword">while</span> ( it.hasNext() ) &#123;</span><br><span class="line">        String s = it.next();</span><br><span class="line">        <span class="keyword">if</span> ( <span class="string">"fd"</span>.equals(s) ) &#123;</span><br><span class="line">            it.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里同样是使用java.util.AbstractList$Itr迭代器进行获取. 但为什么和上面的情况不一样呢, 也就是为什么没有触发<code>java.lang.IllegalStateException</code>异常, 原因是因为我们在remove之前调用了next()方法, 改变了lastRet的值, 绕过了remove方法前面的if判断.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Index of element to be returned by subsequent call to next.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Index of element returned by most recent call to next or</span></span><br><span class="line"><span class="comment"> * previous.  Reset to -1 if this element is deleted by a call</span></span><br><span class="line"><span class="comment"> * to remove.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> lastRet = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> i = cursor; <span class="comment">// i 为0</span></span><br><span class="line">        E next = get(i);</span><br><span class="line">        lastRet = i; <span class="comment">// lastRet接收i的赋值后变成了0.</span></span><br><span class="line">        cursor = i + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">        checkForComodification();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>) <span class="comment">// 所以判断不成立, 跳出下面的异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">    checkForComodification(); </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        AbstractList.<span class="keyword">this</span>.remove(lastRet); </span><br><span class="line">        <span class="keyword">if</span> (lastRet &lt; cursor)</span><br><span class="line">            cursor--;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br></pre></td></tr></table></figure><p>当跳出这个判断后, 执行<code>AbstractList.this.remove(lastRet);</code>这一句的时候, this代表是迭代器也就是<code>java.util.AbstractList$Itr</code>, 这里的remove方法是java.util.AbstractList#remove中的方法, 这个方法什么也没做, 直接抛出了一个异常. 因此上面的代码抛出异常.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>三种异常都发生在迭代器之上.<br>其中第一种最常见, 也是最容易犯的一种.<br>原因在于一边在遍历, 一边在修改, 导致底层实现代码出现错误, 从而出现异常.</p><p>第二和第三则在于Arrays.asList()方法所产生的ArrayList并不是java.util.ArrayList, 而是Arrays内部类中的ArrayList. 而这个内部ArrayList是没有覆盖父类java.util.AbstractList的add和remove方法的(但覆盖了set get, 所以这2个方法不受影响), 所以不管是通过获取这个List的迭代器来进行remove(<strong>迭代器没有提供add方法</strong>)操作(上面说了迭代器最后调用remove方法还是java.util.AbstractList提供的方法), 还是调用这个List本身继承过来的add/remove方法进行操作, 最后都是调用的父类中的方法, 而父类中的方法, 就只有一行抛出异常的代码. 所以会发生异常.</p><p>我们在开发时, 只需要记住. 在通过迭代器的方法遍历集合时不要对其进行remove和add操作就可以了. 至于set方法是可以的.</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>有的公司面试时会问到这样的问题, 所以这里记录一下分享给大家, 也算是本人一个学习记录分享.</p><p>面试的时候先看面试给你的是通过Arrays.asList()方式获取的集合还是直接new ArrayList()的方式, 如果是前者, 那么可以使用</p><blockquote><p>google上对怎么解决ConcurrentModificationException的方案已经很多, 例如用Collections.synchronizedCollection() 去同步集合,  但是这样可能会影响效率,  JDK5之后concurrent包里面有个CopyOnWriteArrayList, 这个集合迭代的时候可以对集合进行增删操作,  因为迭代器中没有checkForComodification!</p></blockquote><p>这种方式进行删除, <strong>其次不管是增强型for遍历还是普通for遍历都不可以删除, 因为前者的ArrayList是调用的父类中的remove方法, 会抛出不支持操作异常.</strong><br>如果是后者, <strong>那么可以你关心的就是遍历的时候是否通过迭代器的方式, 也就是增强型for循环, 如果是普通for遍历方式, 我想面试官不会问你 - -. 如果是增强型for, 那么就回答不可以, 会抛出并发操作异常.</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;参考:&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/izard999/article/details/6708738&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://blog.csdn.net/izard999/article/details/6708738&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://bbs.itheima.com/thread-41997-1-1.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://bbs.itheima.com/thread-41997-1-1.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;异常1&quot;&gt;&lt;a href=&quot;#异常1&quot; class=&quot;headerlink&quot; title=&quot;异常1&quot;&gt;&lt;/a&gt;异常1&lt;/h2&gt;&lt;p&gt;异常: &lt;strong&gt;java.util.ConcurrentModificationException&lt;/strong&gt; (并发修改异常)&lt;/p&gt;
&lt;p&gt;link: &lt;a href=&quot;http://bbs.itheima.com/thread-41997-1-1.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://bbs.itheima.com/thread-41997-1-1.html&lt;/a&gt; 此贴描述了第一种异常.&lt;br&gt;当我们在使用foreach这个增强型for循环遍历List时, 除了&lt;code&gt;System.out.println();&lt;/code&gt;打印可以之外, 其他add, remove等操作会发生异常(&lt;code&gt;执行set方法不会抛出异常&lt;/code&gt;).&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
      <category term="异常" scheme="http://bennie.im/tags/%E5%BC%82%E5%B8%B8/"/>
    
      <category term="迭代器" scheme="http://bennie.im/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"/>
    
      <category term="集合" scheme="http://bennie.im/tags/%E9%9B%86%E5%90%88/"/>
    
  </entry>
  
  <entry>
    <title>java多态中的虚方法调用</title>
    <link href="http://bennie.im/2017/02/19/virtual-method-invoke-in-java/"/>
    <id>http://bennie.im/2017/02/19/virtual-method-invoke-in-java/</id>
    <published>2017-02-18T16:17:27.000Z</published>
    <updated>2018-12-29T08:13:04.817Z</updated>
    
    <content type="html"><![CDATA[<p>今天偶然看到这个东西, 想起来以前学的时候有点绕糊, 这里随笔记一下吧.</p><p>个人认为虚方法的调用发生在多态中.<br>例如以下两个类, 一个是Employee, 一个是Programmer</p><a id="more"></a><hr><p>类: Employee </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> salary;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Employee中的showInfo方法"</span>);</span><br><span class="line">        System.out.println(<span class="string">"姓名: "</span> + <span class="keyword">this</span>.getName() + <span class="string">", 年龄: "</span> + <span class="keyword">this</span>.getAge()</span><br><span class="line">                + <span class="string">", 工资: "</span> + <span class="keyword">this</span>.getSalary());</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 以下getter setter方法省略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>类Programmer:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Programmer</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Programmer中的showInfo方法"</span> + <span class="string">"\n"</span>);</span><br><span class="line">        System.out.println(<span class="string">"姓名: "</span> + <span class="keyword">this</span>.getName() + <span class="string">", 年龄: "</span> + <span class="keyword">this</span>.getAge()</span><br><span class="line">                + <span class="string">", 工资: "</span> + <span class="keyword">this</span>.getSalary());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过这两个类我们知道Programmer是Employee的子类, 所以拥有其中所有的方法, 包括我们重写的showInfo方法以及未重写的getter和setter方法.</p><p>然后我们再来看下这个代码来了解一下在多态的情况下, 以不同的实例对象调用重写的方法会发生什么情况:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestVitrualMethodInvoke</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Programmer programmer = <span class="keyword">new</span> Programmer();</span><br><span class="line">        programmer.setAge(<span class="number">23</span>);</span><br><span class="line">        programmer.setName(<span class="string">"张三"</span>);</span><br><span class="line">        programmer.setSalary(<span class="number">8000</span>);</span><br><span class="line">        </span><br><span class="line">        Employee employee = <span class="keyword">new</span> Programmer();</span><br><span class="line">        employee.setAge(<span class="number">30</span>);</span><br><span class="line">        employee.setName(<span class="string">"李四"</span>);</span><br><span class="line">        employee.setSalary(<span class="number">5000</span>);</span><br><span class="line">        </span><br><span class="line">        programmer.showInfo();</span><br><span class="line">        employee.showInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>首先我们new了2个Programmer, 但用不同的引用接收. 分别是Employee和Programmer引用.<br>我们知道: <code>Employee employee = new Programmer();</code>这段代码是一个多态的写法, 就是<strong>父类的引用接收子类的实例对象.</strong></p><p>概念: <strong>当父类的引用接收子类的实例对象时, 这时候调用重写的方法, 实际上调用的是重写后的方法, 也就是调用子类的方法, 虽然用于接收实例对象的引用是父类类型.</strong></p><blockquote><p>下面是输出结果:<br>Programmer中的showInfo方法<br>姓名: 张三, 年龄: 23, 工资: 8000</p></blockquote><blockquote><p>Programmer中的showInfo方法<br>姓名: 李四, 年龄: 30, 工资: 5000</p></blockquote><p>两次输出都是子类中被重写的方法.<br>这就是多态中的虚方法调用, 所以我们在今后的开发中需要注意这点.<br>如果我们想调用非子类中重写的方法, 那么就需要用父类的实例对象.<br>或者我们在子类中可以使用super.showInfo()这种方式来调用.</p><p>补充说明: jvm在执行这两段代码时是这样工作的.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Employee employee = new Programmer();</span><br><span class="line">employee.showInfo();</span><br></pre></td></tr></table></figure></p><p>首先<code>编译期间</code>先检查Employee中有无showInfo方法, 若无则无法编译通过.<br>然后在<code>运行期间</code>, 发现这个employee的实际引用的实例对象是Programmer, 所以就去调用Programmer中showInfo()方法, 这就是造成 上述现象的原因.<br>所以我们说多态的对象只有在运行期才可以确定.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天偶然看到这个东西, 想起来以前学的时候有点绕糊, 这里随笔记一下吧.&lt;/p&gt;
&lt;p&gt;个人认为虚方法的调用发生在多态中.&lt;br&gt;例如以下两个类, 一个是Employee, 一个是Programmer&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://bennie.im/categories/Java/"/>
    
    
      <category term="Java" scheme="http://bennie.im/tags/Java/"/>
    
      <category term="虚方法" scheme="http://bennie.im/tags/%E8%99%9A%E6%96%B9%E6%B3%95/"/>
    
      <category term="多态" scheme="http://bennie.im/tags/%E5%A4%9A%E6%80%81/"/>
    
  </entry>
  
  <entry>
    <title>HTML图片预览及AJAX上传</title>
    <link href="http://bennie.im/2017/01/02/image-preview-and-ajax-image-upload/"/>
    <id>http://bennie.im/2017/01/02/image-preview-and-ajax-image-upload/</id>
    <published>2017-01-02T12:16:39.000Z</published>
    <updated>2018-12-29T08:18:28.626Z</updated>
    
    <content type="html"><![CDATA[<p>图片上传前预览，然后ajax上传到服务器一个简单的实现.<br><img src="/images/2018-05-29-173832.jpg" alt=""></p><p>用CSS做了一些界面上的处理，预览是用HTML5中的File和FileRead对象来实现(具体看下文代码注释中描述)，AJAX上传部分主要用到了FormData对象，该对象的作用就是可以让AJAX来异步上传一个二进制文件。<br>后端的处理代码用到是Servlet中提供的两个框架，分别是: <code>commons-fileupload-1.3.1.jar</code>和<code>commons-io-2.4.jar</code>，可以在: <a href="http://archive.apache.org/dist/commons/" target="_blank" rel="noopener">http://archive.apache.org/dist/commons/</a> 下载到这2个jar包.</p><p>下面的实现代码中，会对CSS，JS，以及后端的Java部分进行说明，相关的HTML5对象会提供详细的文档链接。</p><p>最后推荐大家 <strong>Web API 接口一览表: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API</a></strong> 这个地方。<br>理由是：当使用Javascript编写网页代码时，有很多API可以使用并提供相关的示例代码。</p><a id="more"></a><p>前台界面及处理代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AJAX图片上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        body &#123;</span></span><br><span class="line"><span class="undefined">            color: #333;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        p.title &#123;</span></span><br><span class="line"><span class="undefined">            font-size: 30px;</span></span><br><span class="line"><span class="undefined">            width: 500px;</span></span><br><span class="line"><span class="undefined">            hegith: auto;</span></span><br><span class="line"><span class="undefined">            padding-left: 10px;</span></span><br><span class="line"><span class="undefined">            border-left: 5px solid dodgerblue;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        div.big，div.middle，div.small &#123;</span></span><br><span class="line"><span class="undefined">            display: inline-block;</span></span><br><span class="line"><span class="undefined">            margin-right: 10px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .big img.avatar &#123;</span></span><br><span class="line"><span class="undefined">            width: 200px;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .middle img.avatar &#123;</span></span><br><span class="line"><span class="undefined">            width: 100px;</span></span><br><span class="line"><span class="undefined">            height: 100px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .small img.avatar &#123;</span></span><br><span class="line"><span class="undefined">            width: 50px;</span></span><br><span class="line"><span class="undefined">            height: 50px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .desc &#123;</span></span><br><span class="line"><span class="undefined">            color: #999;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .wrapper &#123;</span></span><br><span class="line"><span class="undefined">            position: relative;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .wrapper input &#123;</span></span><br><span class="line"><span class="undefined">            width: 130px;</span></span><br><span class="line"><span class="undefined">            height: 38px;</span></span><br><span class="line"><span class="undefined">            cursor: pointer;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .wrapper .portrait-filebtn &#123;</span></span><br><span class="line"><span class="undefined">            outline: none;</span></span><br><span class="line"><span class="undefined">            border: none;</span></span><br><span class="line"><span class="undefined">            padding: 0;</span></span><br><span class="line"><span class="undefined">            background: url("https://ss1.bdstatic.com/5KZ1bjqh_Q23odCf/static/princess/img/setportrait_btn_da8845e1.png") no-repeat 0 0px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        .wrapper .portrait-file &#123;</span></span><br><span class="line"><span class="undefined">            opacity: 0;</span></span><br><span class="line"><span class="undefined">            position: absolute;</span></span><br><span class="line"><span class="undefined">            left: 0;</span></span><br><span class="line"><span class="undefined">            top: 0;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        div#info &#123;</span></span><br><span class="line"><span class="undefined">            padding: 10px 0;</span></span><br><span class="line"><span class="undefined">            font-size: 15px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/Javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">"fileImg"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> infoDiv = <span class="built_in">document</span>.getElementById(<span class="string">"info"</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> avatarImgs = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"avatar"</span>);</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="javascript">            <span class="comment">// 为文件选择input绑定一个change事件监听.</span></span></span><br><span class="line"><span class="javascript">            fileInput.addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                /**</span></span><br><span class="line"><span class="javascript">                 * 所以这里的<span class="keyword">this</span>指针是input对象</span></span><br><span class="line"><span class="javascript">                 * <span class="keyword">this</span>.files获取的是WEB_API中的FileList对象。</span></span><br><span class="line"><span class="javascript">                 * 参考: https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/API/FileList</span></span></span><br><span class="line"><span class="undefined">                 * */</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> file = <span class="keyword">this</span>.files[<span class="number">0</span>]; </span></span><br><span class="line"><span class="undefined">                </span></span><br><span class="line"><span class="javascript">                <span class="comment">// 获取文件的大小且四舍五入后不保留小数。</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> fileSize = (file.size / <span class="number">1024</span>).toFixed(); </span></span><br><span class="line"><span class="undefined">                </span></span><br><span class="line"><span class="javascript">                <span class="comment">// 获取文件名</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> fileName = file.name; </span></span><br><span class="line"><span class="xml">                infoDiv.innerHTML = "<span class="tag">&lt;<span class="name">b</span>&gt;</span>Size: <span class="tag">&lt;/<span class="name">b</span>&gt;</span>" + fileSize + "Kib<span class="tag">&lt;<span class="name">br</span> /&gt;</span>" + "<span class="tag">&lt;<span class="name">b</span>&gt;</span>Name: <span class="tag">&lt;/<span class="name">b</span>&gt;</span>" + fileName;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                /**</span></span><br><span class="line"><span class="javascript">                 * WEB_API FileReader对象，参考: https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/API/FileReader</span></span></span><br><span class="line"><span class="undefined">                 */</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> fileReader = <span class="keyword">new</span> FileReader(); </span></span><br><span class="line"><span class="undefined">                </span></span><br><span class="line"><span class="undefined">                /**</span></span><br><span class="line"><span class="undefined">                 * 开始读取指定的File对象中的内容。</span></span><br><span class="line"><span class="undefined">                 * 将File对象中的文件内容读入到FileReader对象result属性中。</span></span><br><span class="line"><span class="javascript">                 * 关于这个方法的介绍推荐大家阅读: https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/API/FileReader</span></span></span><br><span class="line"><span class="undefined">                 */</span></span><br><span class="line"><span class="undefined">                fileReader.readAsDataURL(file);</span></span><br><span class="line"><span class="undefined">                </span></span><br><span class="line"><span class="javascript">                <span class="comment">// 当fileReader载入的时候，我们把读入的数据给下面我们定义的img标签的src属性中。</span></span></span><br><span class="line"><span class="javascript">                fileReader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// 我这里循环是因为我弄了3种尺寸的预览图.</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; avatarImgs.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> avatarImg = avatarImgs[i];</span></span><br><span class="line"><span class="undefined">                        </span></span><br><span class="line"><span class="undefined">                        /**</span></span><br><span class="line"><span class="undefined">                         * 上面说了读入的会把File对象的文件内容读到result属性，</span></span><br><span class="line"><span class="undefined">                         * 所以这里获取result的值赋给img标签的src属性，就可以实现在上传前图片预览的功能了。</span></span><br><span class="line"><span class="undefined">                         *</span></span><br><span class="line"><span class="undefined">                         * 这里的result指的是: 读取到File对象中的图片文件内容。</span></span><br><span class="line"><span class="undefined">                         * 这个属性中的值的格式就是一个经过base64编码的图片数据URL。</span></span><br><span class="line"><span class="undefined">                         * 差不多就是这样的格式，应该都见过的。</span></span><br><span class="line"><span class="undefined">                         * data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/7R+KUGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAADwcAVo</span></span><br><span class="line"><span class="undefined">                         * </span></span><br><span class="line"><span class="javascript">                         * 了解更多请看: https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/API/FileReader/result</span></span></span><br><span class="line"><span class="undefined">                         */</span></span><br><span class="line"><span class="javascript">                        avatarImg.src = <span class="keyword">this</span>.result;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">//avatarImg.src = event.target.result;</span></span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// ajax发送请求上传文件.</span></span></span><br><span class="line"><span class="undefined">                    ajaxSaveToServer(file);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            &#125;，<span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined">        &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// AJAX上传</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">ajaxSaveToServer</span>(<span class="params">imgFile</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">            xhr.open(<span class="string">"post"</span>, <span class="string">"saveImg"</span>，<span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /**</span></span><br><span class="line"><span class="undefined">             * XMLHttpRequest Level 2添加了一个新的接口FormData。</span></span><br><span class="line"><span class="undefined">             * 利用FormData对象，我们可以通过Javascript用一些键值对来模拟一系列表单控件，</span></span><br><span class="line"><span class="javascript">             * 我们还可以使用XMLHttpRequest的send()方法来异步的提交这个<span class="string">"表单"</span>。</span></span><br><span class="line"><span class="undefined">             * 比起普通的ajax，使用FormData的最大优点就是我们可以异步上传一个二进制文件。</span></span><br><span class="line"><span class="undefined">             *</span></span><br><span class="line"><span class="javascript">             * 上面的解释很清楚了，更多信息可以参考这里: https:<span class="comment">//developer.mozilla.org/zh-CN/docs/Web/API/FormData</span></span></span><br><span class="line"><span class="undefined">             */</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /**</span></span><br><span class="line"><span class="undefined">             * 给当前FormData对象添加一个键/值对。</span></span><br><span class="line"><span class="undefined">             */</span></span><br><span class="line"><span class="javascript">            formData.append(<span class="string">"img"</span>，imgFile);</span></span><br><span class="line"><span class="undefined">            </span></span><br><span class="line"><span class="javascript">            <span class="comment">// 后面的就是发送请求处理响应了。</span></span></span><br><span class="line"><span class="undefined">            xhr.send(formData);</span></span><br><span class="line"><span class="javascript">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> state = xhr.readyState;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> status = xhr.status;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (state == <span class="number">4</span> &amp;&amp; status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="undefined">                    alert(xhr.responseText);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>Choose Image<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"portrait-filebtn"</span> <span class="attr">value</span>=<span class="string">"Choose"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"portrait-file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"fileImg"</span> <span class="attr">accept</span>=<span class="string">".jpg,.png,.gif,.bmp,.jpeg"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pass-portrait-msg"</span>&gt;</span>Supporting formats: jpg、jpeg、gif、png、bmp<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>Image Preview<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"preview"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"big"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"desc"</span>&gt;</span>200x200 Pixel<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"desc"</span>&gt;</span>100x100 Pixel<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"small"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"desc"</span>&gt;</span>50x50 Pixel<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面在注释里js和WEB_API的介绍说完了，这里说一下css代码相关的地方。<br>首先。class为wrapper的div，需要设置position为relative，然后将里面的第二个input，也就是文件选择的input。<br>它的position设置为absolute，absolute会相关于第一个position为非static的父元素来定位。<br>所以这里就是相对于刚才那个class为container的div来定位，然后我们让它left和top都为0，让它紧贴着div，然后再给它的透明度设置为0，通过<code>opacity: 0;</code>来设置。<br>这样子做了之后他前面的类型为button的input就会”覆盖”它，说是覆盖其实是因为透明度为0，人的眼睛看不到了。但是在页面上还是存在，所以我们不能设置display为none这个样式。因为我们需要能点击它。</p><p>其他的css就是我个人的一些处理，没什么特别的地方。</p><p>再然后我们来看服务端java代码，我用的servlet配合2个jar包来实现上传。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxxx.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileUploadException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveFile</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件上传路径</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UPLOAD_DIRECTORY = <span class="string">"upload"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 文件路径分隔符，linux为/，windows为\</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String File_SEPARATOR = File.separator;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 允许的文件contentype类型.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] ALLOWED_TYPE = &#123; <span class="string">"image/jpg"</span>，<span class="string">"image/jpeg"</span>，<span class="string">"image/png"</span>，<span class="string">"image/gif"</span>，<span class="string">"image/bmp"</span> &#125;;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查是否为允许的文件类型。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkContentype</span> <span class="params">(String contentType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( contentType == <span class="keyword">null</span> ) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将数组转成list.</span></span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(ALLOWED_TYPE);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 查看是否存在于list中，如果有任意一个存在，那么就是合法的类型，否则就是不合法的。</span></span><br><span class="line">        <span class="keyword">return</span> list.contains(contentType);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span> <span class="params">(HttpServletRequest request，HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException，IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">        PrintWriter writer = response.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不是二进制文件，那么上传失败。</span></span><br><span class="line">            <span class="keyword">if</span> ( !ServletFileUpload.isMultipartContent(request) ) &#123;</span><br><span class="line">                writer.write(<span class="string">"上传失败"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">            ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">            List&lt;FileItem&gt; fileItems = fileUpload.parseRequest(request);</span><br><span class="line">            FileItem fileItem = fileItems.get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            String contentType = fileItem.getContentType();</span><br><span class="line">            <span class="keyword">if</span> ( !checkContentype(contentType) ) &#123;</span><br><span class="line">                writer.write(<span class="string">"非法文件，请选择正确的图片文件"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取上传文件的文件夹真实的物理路径。</span></span><br><span class="line">            String uploadPath = getServletContext().getRealPath(File_SEPARATOR + UPLOAD_DIRECTORY);</span><br><span class="line">            File uploadPathFile = <span class="keyword">new</span> File(uploadPath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 文件夹不存在则创建文件夹.</span></span><br><span class="line">            <span class="keyword">if</span> ( !uploadPathFile.exists() ) &#123;</span><br><span class="line">                uploadPathFile.mkdir();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取文件名.</span></span><br><span class="line">            String name = fileItem.getName();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 如果文件名是完整的路径形式(火狐浏览器会存在这个现象)，那么截取出文件名。</span></span><br><span class="line">            <span class="keyword">if</span> ( name.contains(File_SEPARATOR) ) &#123;</span><br><span class="line">                name = name.substring(name.lastIndexOf(File_SEPARATOR) + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 文件夹 + 文件名</span></span><br><span class="line">            File imgFile = <span class="keyword">new</span> File(uploadPath + File_SEPARATOR + name);</span><br><span class="line">            fileItem.write(imgFile);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 删除临时文件，这个方法也可以不调，因为在FileItem对象实例被回收的时候会自动清空临时文件，但框架注释说了，为了确保万一最好调用一下。</span></span><br><span class="line">            fileItem.delete();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( imgFile.exists() ) &#123;</span><br><span class="line">                writer.write(<span class="string">"上传成功!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> ( FileUploadException e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            writer.flush();</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span> <span class="params">(HttpServletRequest request，HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException，IOException </span>&#123;</span><br><span class="line">        doPost(request，response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到此就结束了。没什么技术含量，主要是我写来玩的，同时也只用于参考。<br>大家可以看一下上面用的几个HTML5 API对象来了解更多，以便按照自己的需求来开发。</p><p>这里推荐大家阅读张鑫旭的一篇相关博文以获得更多相关的知识《<a href="http://www.zhangxinxu.com/wordpress/2011/09/%E5%9F%BA%E4%BA%8Ehtml5%E7%9A%84%E5%8F%AF%E9%A2%84%E8%A7%88%E5%A4%9A%E5%9B%BE%E7%89%87ajax%E4%B8%8A%E4%BC%A0/" target="_blank" rel="noopener">基于HTML5的可预览多图片Ajax上传</a>》</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;图片上传前预览，然后ajax上传到服务器一个简单的实现.&lt;br&gt;&lt;img src=&quot;/images/2018-05-29-173832.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;用CSS做了一些界面上的处理，预览是用HTML5中的File和FileRead对象来实现(具体看下文代码注释中描述)，AJAX上传部分主要用到了FormData对象，该对象的作用就是可以让AJAX来异步上传一个二进制文件。&lt;br&gt;后端的处理代码用到是Servlet中提供的两个框架，分别是: &lt;code&gt;commons-fileupload-1.3.1.jar&lt;/code&gt;和&lt;code&gt;commons-io-2.4.jar&lt;/code&gt;，可以在: &lt;a href=&quot;http://archive.apache.org/dist/commons/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://archive.apache.org/dist/commons/&lt;/a&gt; 下载到这2个jar包.&lt;/p&gt;
&lt;p&gt;下面的实现代码中，会对CSS，JS，以及后端的Java部分进行说明，相关的HTML5对象会提供详细的文档链接。&lt;/p&gt;
&lt;p&gt;最后推荐大家 &lt;strong&gt;Web API 接口一览表: &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/API&lt;/a&gt;&lt;/strong&gt; 这个地方。&lt;br&gt;理由是：当使用Javascript编写网页代码时，有很多API可以使用并提供相关的示例代码。&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://bennie.im/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="http://bennie.im/tags/Javascript/"/>
    
      <category term="Ajax" scheme="http://bennie.im/tags/Ajax/"/>
    
      <category term="HTML5" scheme="http://bennie.im/tags/HTML5/"/>
    
  </entry>
  
  <entry>
    <title>JS拖拽图片简单例子</title>
    <link href="http://bennie.im/2017/01/01/js-drag-drop-image-small-example/"/>
    <id>http://bennie.im/2017/01/01/js-drag-drop-image-small-example/</id>
    <published>2016-12-31T20:50:00.000Z</published>
    <updated>2018-12-29T08:13:04.836Z</updated>
    
    <content type="html"><![CDATA[<p>Reference: <a href="http://w3schools.bootcss.com/jsref/dom_obj_event.html" target="_blank" rel="noopener">http://w3schools.bootcss.com/jsref/dom_obj_event.html</a></p><p>在H5中所有的元素都是可以被拖拽的, 通过给元素添加<code>draggable=&quot;true&quot;</code>属性.</p><p>相关的地方: </p><ol><li><code>ondragover</code> 事件发生在: 元素<code>拖拽</code>到<code>拖放</code>的目标元素之上时.(事件处理程序多次调用)</li><li><code>ondragstart</code> 事件发生在: 元素<code>开始拖拽</code>之时(事件处理程序1次调用)</li><li><code>ondrop</code> 事件发生在: <code>被拖拽</code>的元素<code>完成拖放</code>到目标元素盒子区域这一动作.(事件处理程序1次调用)</li><li><code>事件的默认行为</code>, 比如说在复选框上点击按钮会发生选中或取消选中事件. 这里需要在ondragover事件里阻止浏览器默认打开的行为. </li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DataTransfer" target="_blank" rel="noopener">dataTransfer对象</a>. 在进行拖放操作时，进行数据的存储, 这个对象也保存了拖拽元素的数据.</li></ol><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;JS拖拽图片简单例子&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">.drop-target &#123;</span><br><span class="line">border: 1px solid black;</span><br><span class="line">width: 300px;</span><br><span class="line">height: 300px;</span><br><span class="line">&#125;</span><br><span class="line">img#img &#123;</span><br><span class="line">width: 200px;</span><br><span class="line">height: 200px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/Javascript&quot;&gt;</span><br><span class="line">function allowDrop(e) &#123;</span><br><span class="line">e.preventDefault();</span><br><span class="line">&#125;</span><br><span class="line">function dragStart(event) &#123;</span><br><span class="line">var dataTransfer = event.dataTransfer;</span><br><span class="line">dataTransfer.setData(&quot;id&quot;, event.target.id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function drop(event) &#123;</span><br><span class="line">var dataTransfer = event.dataTransfer;</span><br><span class="line">var imgId = dataTransfer.getData(&quot;id&quot;);</span><br><span class="line">var img = document.getElementById(imgId);</span><br><span class="line"></span><br><span class="line">var div = event.target;</span><br><span class="line">div.appendChild(img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;drop-target&quot; ondragover=&quot;allowDrop(event)&quot; ondrop=&quot;drop(event)&quot;&gt;</span><br><span class="line">请将图片拖放到这里来.</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;img id=&quot;img&quot; ondragstart=&quot;dragStart(event)&quot; src=&quot;https://ooo.0o0.ooo/2017/08/20/599865a851d49.png&quot; draggable=&quot;true&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>在ondragstart那里获取图片的id属性值, 然后在drop方法里获取属性值获取图片对象, 接着添加到div里即可. 在ondragover事件里做处理操作, 让div取消默认行为, 接受图片的放入.</p><p>另外, event对象的两次target分别是被拽放对象img和拖放接受对象div.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Reference: &lt;a href=&quot;http://w3schools.bootcss.com/jsref/dom_obj_event.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://w3schools.bootcss.com/jsref/dom_obj_event.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在H5中所有的元素都是可以被拖拽的, 通过给元素添加&lt;code&gt;draggable=&amp;quot;true&amp;quot;&lt;/code&gt;属性.&lt;/p&gt;
&lt;p&gt;相关的地方: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ondragover&lt;/code&gt; 事件发生在: 元素&lt;code&gt;拖拽&lt;/code&gt;到&lt;code&gt;拖放&lt;/code&gt;的目标元素之上时.(事件处理程序多次调用)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ondragstart&lt;/code&gt; 事件发生在: 元素&lt;code&gt;开始拖拽&lt;/code&gt;之时(事件处理程序1次调用)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ondrop&lt;/code&gt; 事件发生在: &lt;code&gt;被拖拽&lt;/code&gt;的元素&lt;code&gt;完成拖放&lt;/code&gt;到目标元素盒子区域这一动作.(事件处理程序1次调用)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;事件的默认行为&lt;/code&gt;, 比如说在复选框上点击按钮会发生选中或取消选中事件. 这里需要在ondragover事件里阻止浏览器默认打开的行为. &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/DataTransfer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;dataTransfer对象&lt;/a&gt;. 在进行拖放操作时，进行数据的存储, 这个对象也保存了拖拽元素的数据.&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="前端" scheme="http://bennie.im/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Javascript" scheme="http://bennie.im/tags/Javascript/"/>
    
  </entry>
  
</feed>
